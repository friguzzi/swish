<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>PLP Tutorial</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
        <link rel="stylesheet" type="text/css" href="css/unife.css">
        <link rel="stylesheet" type="text/css" href="css/other.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.css">
        <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
        <script src="http://code.jquery.com/ui/1.11.3/jquery-ui.min.js"></script>
        <script src="js/lpn.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <div id="page-wrapper" class="w3-container">
            <div id="header">
                <header>
                    <br/>
                    <div class="w3-container unife-teal w3-padding-left">
                        <div class="w3-padding-left">
                            <h1>Probabilistic Logic Programming Tutorial</h1>
                        </div>
                    </div>
                </header>

            </div>

            <div id="content" class="w3-container">
                <div id="index">
                    <h1><a id="Tutorial_0"></a>Tutorial</h1>
                    <ul>
                        <li><em>Theoretical preliminaries</em>
                            <ul>
                                <li><a href="#lpad">Logic Program with Annotated Disjunctions (LPAD)</a></li>
                            </ul>
                        </li>
                        <li><em>Basic examples with exact inference</em>
                            <ul>
                                <li><a href="#coin">Coin</a>. Simple unconditional inference.</li>
                                <li><a href="#dice">Dice</a>. Conditional inference and inference with graphical results.</li>
                                <li><a href="#epidemic">Epidemic</a>. LPAD with implicit <em>null</em> atom in the clauses, noisy or between rule groundings.</li>
                                <li><a href="#earthquake">Earthquake</a> noisy or between different rules.</li>
                                <li><a href="#sneezing">Medical symptoms</a> noisy or between different rules.</li>
                            </ul>
                        </li>
                        <li><em>Examples with approximate inference (Monte Carlo sampling)</em>
                            <ul>
                                <li><a href="#coinmc">Coin (variant)</a>. Approximate inference variant of <a href="#coin">Coin</a>.</li>
                                <li><a href="#markov_chain">Markov chain</a> Approximate inference.</li>
                                <li><a href="#pctl_slep">Probabilistic Computation Tree Logic</a> Approximate inference for computing expectations, mixing LPADs and Prolog.</li>
                                <li><a href="#arithm">Random arithmetic functions</a>Conditional approximate inference with rejection sampling and Metropolis-Hastings</li>
                            </ul>
                        </li>
                        <li><em>Examples with structure and parameter learning</em>
                            <ul>
                                <li><a href="#mach">Machines</a>. Parameter learning.</li>
                                <li><a href="#registration">Registration</a>. Structure learning.</li>
                                <li><a href="#bongard">Bongard</a>. Test the learned program with graphical results.</li>
                            </ul>
                        </li>
                        <li><em>More Examples with inference</em>
                            <ul>
                                <li>see <a target="_blank" href="http://cplint.lamping.unife.it/example/inference/inference_examples.swinb">cplint inference example programs</a></li>
                            </ul>
                        </li>
                        <li><em>More Examples with structure and parameter learning</em>
                            <ul>
                                <li>see <a target="_blank" href="http://cplint.lamping.unife.it/example/learning/learning_examples.swinb">cplint learning example programs</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <hr/>
                <div id="lpad">
                    <h1><a id="Logic_Program_with_Annotated_Disjunction_0"></a>Logic Program with Annotated Disjunction</h1>
                    <h3><a id="Definition_2"></a>Definition</h3>
                    <p>A Logic Program with Annotated Disjunction (LPAD) consists of a set of rules of the following form:</p>
                    <pre><code class="language-{.pl}"><span class="hljs-attribute">h_1 </span>: a_1 ; ... ; <span class="hljs-attribute">h_n </span>: <span class="hljs-attribute">a_n </span>:- b_1, ..., b_m. 
</code></pre>
                    <p>where <code>h_i</code> are atoms, <code>b_i</code> are literals and <code>a_i</code> are real numbers between 0 and 1 such that the sum of all <code>a_i</code> is 1. The set of elements <code>h_i : a_i</code> compose the head of a rule, while the set <code>b_i</code> is the body. Disjunction in  the  head  is  represented  with  a  semicolon  and  atoms  in  the  head  are  separated  from probabilities by a colon.
                        If the head of a rule contains only one element <code>h : 1</code>, we can simpy write this element as <code>h</code>, i.e. the clause takes the form of a normal prolog clause. Therefore</p>
                    <pre><code class="language-{.pl}">h : <span class="hljs-number">1</span> :- <span class="hljs-keyword">b_1, </span>..., <span class="hljs-keyword">b_m.
</span></code></pre>
                    <p>is equivalent to</p>
                    <pre><code class="language-{.pl}">h :- <span class="hljs-keyword">b_1, </span>..., <span class="hljs-keyword">b_m.
</span></code></pre>
                    <p>If the clause has an empty body, it can be represented like this:</p>
                    <pre><code class="language-{.pl}"><span class="hljs-attribute">h_1 </span>: a_1 ; ... ; <span class="hljs-attribute">h_n </span>: a_n. 
</code></pre>
                    <p>If the sum of all the <code>a_i</code> is smaller than 1, an extra disjunct <code>null</code> is assumed with probability <em>1 - sum(a_i)</em>. Therefore</p>
                    <pre><code class="language-{.pl}"><span class="hljs-tag">h_1</span> : 0<span class="hljs-class">.5</span> ; <span class="hljs-tag">h_2</span> : 0<span class="hljs-class">.2</span> <span class="hljs-pseudo">:-</span> <span class="hljs-tag">b_1</span>, ..., <span class="hljs-tag">b_m</span>. 
</code></pre>
                    <p>is equivalent to</p>
                    <pre><code class="language-{.pl}"><span class="hljs-rule"><span class="hljs-attribute">null </span>:<span class="hljs-value"> <span class="hljs-number">0.3</span> </span></span>; <span class="hljs-tag">h_1</span> : 0<span class="hljs-class">.5</span> ; <span class="hljs-tag">h_2</span> : 0<span class="hljs-class">.2</span> <span class="hljs-pseudo">:-</span> <span class="hljs-tag">b_1</span>, ..., <span class="hljs-tag">b_2</span>.
</code></pre>
                    <hr>
                    <ul>
                        <li>Reference: J. Vennekens, S. Verbaeten, and M. Bruynooghe. <em>Logic programs with annotated disjunctionsi</em>. In International Conference on Logic Programming, volume 3131 of LNCS, pages 195-209. Springer, 2004.</li>
                    </ul>
                    <hr>
                    <p><a href="#index">Back to Index</a></p>
                </div>

                <hr/>
                <div id="coin">
                    <h1><a id="Coin_0"></a>Coin</h1>
                    <p>This example shows the basic concepts of <em>Logic Programs with Annotated Disjunctions</em> and how to use the tool <em>cplint on SWISH</em> to perform exact inference or simply inference.
                        Let us suppose that we have one coin that we are not sure if it is biased. Now, if we toss the coin, what is the probability that it will land on head?</p>
                    <h3><a id="Writing_the_program_step_by_step_5"></a>Writing the program step by step</h3>
                    <p>In our example we want to write a rule which states that if the coin is fair (not biased) and we toss it, it will land on heads with 50% probability and on tail with 50% probability. We can write such a rule as below:</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function">heads</span>(Coin)<span class="hljs-value">: <span class="hljs-number">1</span>/<span class="hljs-number">2</span>;</span> <span class="hljs-function">tails</span>(Coin) <span class="hljs-value">: <span class="hljs-number">1</span>/<span class="hljs-number">2</span> :- <span class="hljs-function">toss</span>(Coin),\+<span class="hljs-function">biased</span>(Coin).
</span></code></pre>
                    <p>Note that <em>1/2 + 1/2 = 1</em>.</p>
                    <p>Now we want to write down a second rule which states that if the coin is biased it will land on heads with 60% probability and on tails with 40% probability.</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function">heads</span>(Coin)<span class="hljs-value">: <span class="hljs-number">0.6</span> ;</span> <span class="hljs-function">tails</span>(Coin) <span class="hljs-value">: <span class="hljs-number">0.4</span> :- <span class="hljs-function">toss</span>(Coin), <span class="hljs-function">biased</span>(Coin).
</span></code></pre>
                    <p>We are not sure if the coin is biased or not, we know that there is a 90% probability that the coin is fair and a 10% probability that the coin is biased. Therefore we can write the following probabilistic fact (an LPAD rule without body).</p>
                    <pre><code class="language-{.pl}"><span class="hljs-tag">fair</span>(<span class="hljs-tag">Coin</span>)<span class="hljs-pseudo">:0</span><span class="hljs-class">.9</span> ; <span class="hljs-tag">biased</span>(<span class="hljs-tag">Coin</span>)<span class="hljs-pseudo">:0</span><span class="hljs-class">.1</span>.
</code></pre>
                    <p>Finally we state the fact that we will certainly toss the coin. <em>Note:</em> this fact is ground.</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">toss</span><span class="hljs-params">(coin)</span></span>: <span class="hljs-number">1</span>.
</code></pre>
                    <p>If the head of a rule contains only one element <code>h:1</code>, we can simpy write this element as <code>h</code>. Therefore we can write the previous fact (a fact can be seen as a rule without body) in this way:</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">toss</span><span class="hljs-params">(coin)</span></span>.
</code></pre>
                    <h3><a id="Choosing_the_editor_30"></a>Choosing the editor</h3>
                    <p>Before starting write our program, we need to choose an editor between “Prolog” or “LPAD”. If we choose the “Prolog” editor we need to add some commands before and after our program (see subsection <em>Full program with Prolog editor</em>). Moreover the syntax of the query is different between these two editors.</p>
                    <p>In this section we will see both editors (subsections <em>Full program with Prolog editor</em> and <em>Full program with LPAD editor</em>). However in the next examples of the tutorial we will use only the “Prolog” editor.</p>
                    <h3><a id="Full_program_with_the_Prolog_editor_prolog_editor_36"></a>Full program with the Prolog editor {#prolog_editor}</h3>
                    <p>The program is almost complete, what we need now is to load the library <code>pita</code> in order to perform exact inference (if we want to perform approximate inference, instead, we need to load <code>mcintyre</code>, see <a href="#coinmc">Coin variant</a>. Therefore we import this library with the built-in predicate <code>use_module/1</code>. So we need to write</p>
                    <pre><code class="language-{.pl}">:- <span class="hljs-function"><span class="hljs-title">use_module</span><span class="hljs-params">(library(pita)</span></span>).
</code></pre>
                    <p>Moreover, after <code>:- use_module(library(pita))</code> we need to write <code>:- pita.</code> in order to initalize the library and the program should be enclosed by <code>:- begin_lpad.</code> and <code>:- end_lpad.</code> (respectively at the begin and at the end of the program). These goals are mandatory to initialize the inference system.</p>
                    <p>The full LPAD of this example is shown below.</p>
                    <div class="nb-cell program prolog">
                        <pre><code class="language-{.pl}"><span class="hljs-comment">% load the ‘pita’ library to perform inference</span>
:- <span class="hljs-atom">use_module</span>(<span class="hljs-atom">library</span>(<span class="hljs-atom">pita</span>)).
:- <span class="hljs-atom">pita</span>.
<span class="hljs-comment">% to be written before the program</span>
:- <span class="hljs-atom">begin_lpad</span>.
<span class="hljs-comment">% Rules</span>
<span class="hljs-atom">heads</span>(<span class="hljs-name">Coin</span>): <span class="hljs-number">1</span>/<span class="hljs-number">2</span>; <span class="hljs-atom">tails</span>(<span class="hljs-name">Coin</span>) : <span class="hljs-number">1</span>/<span class="hljs-number">2</span> :- <span class="hljs-atom">toss</span>(<span class="hljs-name">Coin</span>),\+<span class="hljs-atom">biased</span>(<span class="hljs-name">Coin</span>).
<span class="hljs-atom">heads</span>(<span class="hljs-name">Coin</span>): <span class="hljs-number">0.6</span> ; <span class="hljs-atom">tails</span>(<span class="hljs-name">Coin</span>) : <span class="hljs-number">0.4</span> :- <span class="hljs-atom">toss</span>(<span class="hljs-name">Coin</span>),<span class="hljs-atom">biased</span>(<span class="hljs-name">Coin</span>).
<span class="hljs-comment">% Facts</span>
<span class="hljs-atom">fair</span>(<span class="hljs-name">Coin</span>): <span class="hljs-number">0.9</span> ; <span class="hljs-atom">biased</span>(<span class="hljs-name">Coin</span>): <span class="hljs-number">0.1</span>.
<span class="hljs-atom">toss</span>(<span class="hljs-atom">coin</span>).
<span class="hljs-comment">% to be written after the program</span>
:- <span class="hljs-atom">end_lpad</span>.
</code></pre>
                    </div>
                    <h4><a id="How_to_execute_a_query_63"></a>How to execute a query</h4>
                    <p>Ok, we have our program, now what?!</p>
                    <p>Now it’s time to submit some queries!</p>
                    <p class="test">To query a program you must use the prob/2 predicate with the following syntax</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">prob</span><span class="hljs-params">(:Atom, -P)</span></span>.
</code></pre>
                    <p><code>Atom</code> is the query that we want to perform, while <code>P</code> is the variable that will contain the probability that <code>Atom</code> is true (a float between 0 and 1).</p>
                    <p>For instance, let us ask for the probability that the tossed coin will land on head. We can do it with the following query</p>
                    <div class="nb-cell query">
                        <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">prob</span><span class="hljs-params">(heads(coin)</span></span>,P).
</code></pre>
                    </div>
                    <p>To try this example click on the triangle icon next to the query. We will see that the coin will land on heads with 51% probability. In fact <em>P(heads) = P(heads, fair) + P(heads, biased) = P(heads|fair)P(fair) + P(heads|biased)P(biased) = 0.5<em>0.9 + 0.6</em>0.1 = 0.51</em>.</p>
                    <hr>
                    <p>Complete example: <a target="_blank" href="http://cplint.lamping.unife.it/example/inference/coin.pl">coin.pl</a></p>
                    <hr>
                    <ul>
                        <li>Reference: J. Vennekens, S. Verbaeten, and M. Bruynooghe. <em>Logic programs with annotated disjunctions</em>. In International Conference on Logic Programming, volume 3131 of LNCS, pages 195-209. Springer, 2004.</li>
                    </ul>
                    <hr>
                    <p><a href="#index">Back to Index</a></p>

                </div>
                <hr/>
                <div id="dice">
                    <h1><a id="Dice_0"></a>Dice</h1>
                    <p>In this section we illustrate an example that models a game with a six-sided dice. The dice is repeatedly thrown until the outcome is six. When the outcome is six, the game stops.
                        We will show how to perform a simple query, how to perform a conditional query and how to execute a query whose results are graphically represented by a histogram.</p>
                    <h3><a id="Writing_the_program_step_by_step_5"></a>Writing the program step by step</h3>
                    <p>First of all we want to write a fact which states that at time 0 the die land on one of its faces with a uniform probability distribution (1/6 for each face). We use the predicate <code>on(T,F)</code> which means that the die landed on face F at time T.</p>
                    <pre><code class="language-{.pl}">on(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>):<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;on(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>):<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;on(<span class="hljs-number">0</span>,<span class="hljs-number">3</span>):<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;
on(<span class="hljs-number">0</span>,<span class="hljs-number">4</span>):<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;on(<span class="hljs-number">0</span>,<span class="hljs-number">5</span>):<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;on(<span class="hljs-number">0</span>,<span class="hljs-number">6</span>):<span class="hljs-number">1</span>/<span class="hljs-number">6.</span>
</code></pre>
                    <p>The following rule states that at time T the die lands on one of its faces with equal probability if at the previous time point it was thrown and it did not land on face 6.</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X,<span class="hljs-number">1</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X,<span class="hljs-number">2</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X,<span class="hljs-number">3</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;
<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X,<span class="hljs-number">4</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X,<span class="hljs-number">5</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X,<span class="hljs-number">6</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>:-
  X1 <span class="hljs-keyword">is</span> X-<span class="hljs-number">1</span>,X1&amp;gt;=<span class="hljs-number">0</span>,<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X1,_)</span></span>,
  \+ <span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X1,<span class="hljs-number">6</span>)</span></span>.
</code></pre>
                    <h3><a id="Full_program_with_Prolog_editor_19"></a>Full program with Prolog editor</h3>
                    <p>Below we can see the full LPAD of the example.</p>
                    <div class="nb-cell program prolog"><pre><code class="language-{.pl}">% Load 'pita' library <span class="hljs-keyword">to</span> perform inference
:- use_module(library(pita)).
:- pita.
% <span class="hljs-keyword">to</span> be written <span class="hljs-keyword">before</span> <span class="hljs-keyword">the</span> program
:- begin_lpad.
% T = <span class="hljs-number">0</span>
<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">3</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;
<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">4</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">5</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">6</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6.</span>
% T &gt; <span class="hljs-number">0</span>
<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X,<span class="hljs-number">1</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X,<span class="hljs-number">2</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X,<span class="hljs-number">3</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;
<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X,<span class="hljs-number">4</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X,<span class="hljs-number">5</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X,<span class="hljs-number">6</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>:-
  X1 <span class="hljs-keyword">is</span> X-<span class="hljs-number">1</span>,X1&gt;=<span class="hljs-number">0</span>,<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X1,_)</span></span>,
  \+ <span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X1,<span class="hljs-number">6</span>)</span></span>.

evidence:-
  <span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)</span></span>,
  <span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)</span></span>.

% <span class="hljs-keyword">to</span> be written <span class="hljs-keyword">after</span> <span class="hljs-keyword">the</span> program
:- end_lpad.
    </code></pre></div>
                    <p>Now we ask for the probability that the die will land on face 1 at time 0.</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}">prob(<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)</span></span>,P).
</code></pre></div>
                    <p>At this point we ask for the probability that the die will land on face 1 at time 2. If we submit this query, we can note that the probability that the die will land on one of its faces at time T (with T &gt; 0) decreases. This is because it is the probability that the dice will land on one of its faces at time T and that at time T-1 it did not land on face 6.</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}">prob(<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>)</span></span>,P).
</code></pre></div>
                    <p>We can ask conditional queries with the predicate</p>
                    <pre><code class="language-{.pl}">prob(<span class="hljs-symbol">:Query</span><span class="hljs-symbol">:atom</span>,<span class="hljs-symbol">:Evidence</span><span class="hljs-symbol">:atom</span>,-<span class="hljs-constant">Probability</span><span class="hljs-symbol">:float</span>).
</code></pre>
                    <p>For example, we can ask for the probability that the die will land on face 1 at time 2
                        given that it landed on face 1 at time 0.</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}">prob(<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>)</span></span>,<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)</span></span>,P).
</code></pre></div>
                    <p>If the evidence is composed of more than one atom, add a clause of the form</p>
                    <pre><code class="language-{.pl}"><span class="hljs-atom">evidence</span>:- <span class="hljs-atom">e1</span>,...,<span class="hljs-atom">en</span>.
</code></pre>
                    <p>to the program, where <code>e1,...,en</code> are the evidence atoms, and use the query</p>
                    <pre><code class="language-{.pl}">?- prob(goal,evidence,<span class="hljs-variable">P</span>).
</code></pre>
                    <p>as for example in</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}">prob(<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>)</span></span>,evidence,P).
</code></pre></div>
                    <h3><a id="How_to_execute_a_query_with_graphical_results_82"></a>How to execute a query with graphical results</h3>
                    <p><strong>cplint on SWISH</strong> can show the probabilistic results of a query as histograms. What we have to do is to use the predicate <code>prob_bar/2</code> instead of <code>prob/2</code>. This feature, however, it is only supported if we are using the “Prolog” editor, it is <strong>NOT</strong> supported with the “LPAD” editor.</p>
                    <p>The syntax is the same as <code>prob/2</code>.</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">prob_bar</span><span class="hljs-params">(:Atom,-P)</span></span>.
</code></pre>
                    <p>Where <code>Atom</code> is the query that we want to ask, while <code>P</code> is the variable that will contain a bar chart with two bars, one for the probability of the atom of being true and one for the probability of the atom of being false (1- the first). It provides a graphical representation of the difference between the two values.</p>
                    <p>However, before submitting this kind of query, we need to specify that we want to use the renderer <code>c3</code> by adding the following line before the <code>:- begin_lpad.</code> goal</p>
                    <pre><code class="language-{.pl}">:- <span class="hljs-function"><span class="hljs-title">use_rendering</span><span class="hljs-params">(c3)</span></span>.
</code></pre>
                    <p>Therefore our program becomes</p>
                    <div class="nb-cell program prolog"><pre><code class="language-{.pl}">% load <span class="hljs-keyword">the</span> 'pita' library <span class="hljs-keyword">to</span> perform inference
:- use_module(library(pita)).
:- pita.
% load <span class="hljs-keyword">the</span> graphical renderer
:- use_rendering(c3).
% <span class="hljs-keyword">to</span> be written <span class="hljs-keyword">before</span> <span class="hljs-keyword">the</span> program
:- begin_lpad.
% Program
<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">3</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;
<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">4</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">5</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">6</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6.</span>
<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X,<span class="hljs-number">1</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X,<span class="hljs-number">2</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X,<span class="hljs-number">3</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;
<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X,<span class="hljs-number">4</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X,<span class="hljs-number">5</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>;<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X,<span class="hljs-number">6</span>)</span></span>:<span class="hljs-number">1</span>/<span class="hljs-number">6</span>:-
X1 <span class="hljs-keyword">is</span> X-<span class="hljs-number">1</span>,X1>=<span class="hljs-number">0</span>,<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X1,_)</span></span>,
\+ <span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(X1,<span class="hljs-number">6</span>)</span></span>.
% <span class="hljs-keyword">to</span> be written <span class="hljs-keyword">after</span> <span class="hljs-keyword">the</span> program
:- end_lpad.
</code></pre></div>
                    <p>For istance let us consider again the previous query, this time with a graphical result.</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}">prob_bar(<span class="hljs-function_start"><span class="hljs-keyword">on</span><span class="hljs-params">(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>)</span></span>, P).
</code></pre></div>
                    <hr>
                    <p>Complete example: <a target="_blank" href="http://cplint.lamping.unife.it/example/inference/dice.pl">dice.pl</a></p>
                    <hr>
                    <ul>
                        <li>Reference: J. Vennekens, S. Verbaeten, and M. Bruynooghe. <em>Logic programs with annotated disjunctionsi</em>. In International Conference on Logic Programming, volume 3131 of LNCS, pages 195-209. Springer, 2004.</li>
                    </ul>
                    <hr>
                    <p><a href="#index">Back to Index</a></p>
                </div>

                <hr/>
                <div id="epidemic">
                    <h1><a id="Epidemic_0"></a>Epidemic</h1>
                    <p>In this section we consider a program which models the fact that if somebody has the flu and the climate is cold, there is the possibility that an epidemic or a pandemic arises. We are uncertain about whether the climate is cold but we know for sure that David and Robert have the flu.</p>
                    <h3><a id="Writing_the_program_step_by_step_4"></a>Writing the program step by step</h3>
                    <p>The rule that we want to write is the one which  states that, if somebody has the flu and the climate is cold, an epidemic arises with 60% probability, a pandemic arises with 30% probability, whereas we have a 10% probability that neither an epidemic nor a pandemic arises. We can write</p>
                    <pre><code class="language-{.pl}"><span class="hljs-rule"><span class="hljs-attribute">epidemic </span>:<span class="hljs-value"> <span class="hljs-number">0.6</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">pandemic </span>:<span class="hljs-value"> <span class="hljs-number">0.3</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">null</span>:<span class="hljs-value"> <span class="hljs-number">0.1</span> :- <span class="hljs-function">flu</span>(_), cold.
</span></span></code></pre>
                    <p>As we said in Section <a href="#lpad">Logic Program with Annotated Disjunction</a>, the <code>null</code> atom can be implicit.
                        Therefore the previous rule, without changing its meaning, can be written</p>
                    <pre><code class="language-{.pl}"><span class="hljs-rule"><span class="hljs-attribute">epidemic </span>:<span class="hljs-value"> <span class="hljs-number">0.6</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">pandemic </span>:<span class="hljs-value"> <span class="hljs-number">0.3</span> :- <span class="hljs-function">flu</span>(_), cold.
</span></span></code></pre>
                    <p>The following probabilistic fact says that the weather is cold with a 70% probability. Note that the <code>null</code> atom is implicit here as well.</p>
                    <pre><code class="language-{.pl}">cold : <span class="hljs-number">0.7</span>.
</code></pre>
                    <p>Now we assert that David and Robert have the flu.</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">flu</span><span class="hljs-params">(david)</span></span>.
<span class="hljs-function"><span class="hljs-title">flu</span><span class="hljs-params">(robert)</span></span>.
</code></pre>
                    <h3><a id="Full_program_with_the_Prolog_editor_24"></a>Full program with the Prolog editor</h3>
                    <p>The full program of the example is show below.</p>
                    <div class="nb-cell program prolog"><pre><code class="language-{.pl}"><span class="hljs-comment">% load the ‘pita’ library to perform inference</span>
:- <span class="hljs-atom">use_module</span>(<span class="hljs-atom">library</span>(<span class="hljs-atom">pita</span>)).
:- <span class="hljs-atom">pita</span>.
<span class="hljs-comment">% allows to create graphical results</span>
:- <span class="hljs-atom">if</span>(<span class="hljs-atom">current_predicate</span>(<span class="hljs-atom">use_rendering</span>/<span class="hljs-number">1</span>)).
:- <span class="hljs-atom">use_rendering</span>(<span class="hljs-atom">c3</span>).
:- <span class="hljs-atom">endif</span>.
<span class="hljs-comment">% to be written before the program</span>
:- <span class="hljs-atom">begin_lpad</span>.
<span class="hljs-atom">epidemic</span> : <span class="hljs-number">0.6</span>; <span class="hljs-atom">pandemic</span> : <span class="hljs-number">0.3</span> :- <span class="hljs-atom">flu</span>(<span class="hljs-name">_</span>), <span class="hljs-atom">cold</span>.
<span class="hljs-atom">cold</span> : <span class="hljs-number">0.7</span>.
<span class="hljs-atom">flu</span>(<span class="hljs-atom">david</span>).
<span class="hljs-atom">flu</span>(<span class="hljs-atom">robert</span>).
<span class="hljs-comment">% to be written after the program</span>
:- <span class="hljs-atom">end_lpad</span>.
</code></pre></div>
                    <p>What is the probability that an epidemic arises? To know it we just have to submit the following query.</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">prob</span><span class="hljs-params">(epidemic, P)</span></span>.
</code></pre></div>
                    <p>Let us see the histogram of the previous query</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">prob_bar</span><span class="hljs-params">(epidemic, P)</span></span>.
</code></pre></div>
                    <p>This example shows that conclusions from different groundings of a rule are combined with a noisy or rule: the probability of an epidemic is obtained by combining with noisy or the conclusions of the two groundings of the rule where the only variable is replaced by David or Robert. So the probability of an epidemic if <code>cold</code> is true is <em>0.6+0.6-0.6*0.6=84</em>. Since <code>cold</code> is also uncertain, the overall probability is <em>0.84*0.7=0.588</em>.</p>
                    <hr>
                    <p>Complete example: <a target="_blank" href="http://cplint.lamping.unife.it/example/inference/epidemic.pl">epidemic.pl</a></p>
                    <hr>
                    <ul>
                        <li>Reference: E. Bellodi and F. Riguzzi. <em>Expectation Maximization over binary decision diagrams for probabilistic logic programs</em>. Intelligent Data Analysis, 17(2):343-363, 2013.</li>
                    </ul>
                    <hr>
                    <p><a href="#index">Back to Index</a></p>

                </div>
                <hr/>
                <div id="earthquake">
                    <h1><a id="Earthquake_0"></a>Earthquake</h1>
                    <p>This program models the occurrence of an earthquake depending on its possible causes.</p>
                    <h3><a id="Full_program_with_the_Prolog_editor_4"></a>Full program with the Prolog editor</h3>
                    <p>The first rule states that if there is rupture of a geological fault only, we have a strong earthquake with 30% probability, a moderate earthquake with 50% probability and 20% probability to have no earthquake. The second rule states that if there is a volcanic eruption only, we have a strong earthquake with 20% probability, a moderate earthquake with 60% probability and no earthquake with 20% probability. We also know for sure that we have a fault rupture and a volcanic eruption at Stromboli and a volcanic eruption at Eyjafjallajokull (can you pronounce it? :-) ).</p>
                    <div class="nb-cell program prolog"><pre><code class="language-{.pl}"><span class="hljs-comment">% load the ‘pita’ library to perform inference</span>
:- <span class="hljs-atom">use_module</span>(<span class="hljs-atom">library</span>(<span class="hljs-atom">pita</span>)).
<span class="hljs-comment">% allows to create graphical results</span>
:- <span class="hljs-atom">if</span>(<span class="hljs-atom">current_predicate</span>(<span class="hljs-atom">use_rendering</span>/<span class="hljs-number">1</span>)).
:- <span class="hljs-atom">use_rendering</span>(<span class="hljs-atom">c3</span>).
:- <span class="hljs-atom">endif</span>.
:- <span class="hljs-atom">pita</span>.
<span class="hljs-comment">% to be written before the program</span>
:- <span class="hljs-atom">begin_lpad</span>.
<span class="hljs-comment">% Rules</span>
<span class="hljs-atom">earthquake</span>(<span class="hljs-name">X</span>, <span class="hljs-atom">strong</span>) : <span class="hljs-number">0.3</span> ; <span class="hljs-atom">earthquake</span>(<span class="hljs-name">X</span>, <span class="hljs-atom">moderate</span>) : <span class="hljs-number">0.5</span> :-
<span class="hljs-atom">fault_rupture</span>(<span class="hljs-name">X</span>).
<span class="hljs-atom">earthquake</span>(<span class="hljs-name">X</span>, <span class="hljs-atom">strong</span>) : <span class="hljs-number">0.2</span> ; <span class="hljs-atom">earthquake</span>(<span class="hljs-name">X</span>, <span class="hljs-atom">moderate</span>) : <span class="hljs-number">0.6</span> :-
<span class="hljs-atom">volcanic_eruption</span>(<span class="hljs-name">X</span>).
<span class="hljs-comment">% Facts</span>
<span class="hljs-atom">fault_rupture</span>(<span class="hljs-atom">stromboli</span>).
<span class="hljs-atom">volcanic_eruption</span>(<span class="hljs-atom">stromboli</span>).
<span class="hljs-atom">volcanic_eruption</span>(<span class="hljs-atom">eyjafjallajkull</span>).
<span class="hljs-comment">% to be written after the program</span>
:- <span class="hljs-atom">end_lpad</span>.
</code></pre></div>
                    <p>We can ask the probability of a moderate earthquake at Stromboli by submitting the query:</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">prob</span><span class="hljs-params">(earthquake(stromboli,moderate)</span></span>, P).
</code></pre></div>
                    <p>Let us see the histogram of the previous query</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">prob_bar</span><span class="hljs-params">(earthquake(stromboli,moderate)</span></span>, P).
</code></pre></div>
                    <p>This example shows that conclusions from different rules are combined with a noisy or rule: the probability of a moderate earthquake at Stromboli is obtained by combining with noisy or the grounding of the first rule and the grounding of the second one, where the only variable is replaced by Stromboli. So the probability of an earthquake at Stromboli is <em>1-(1-0.5)*(1-0.6)=0.8</em>. <strong>Note:</strong> if you submit the query the result will be 0.7999999999999998, this is due to numerical approximations performed during the computation.</p>
                    <hr>
                    <p>Complete example: <a target="_blank" href="http://cplint.lamping.unife.it/example/inference/earthquake.pl">earthquake.pl</a></p>
                    <hr>
                    <ul>
                        <li>Reference: F. Riguzzi and N. Di Mauro. <em>Applying the information bottleneck to statistical relational learning</em>. Machine Learning, 86(1):89-114, 2012.
                        </li>
                    </ul>
                    <hr>
                    <p><a href="#index">Back to Index</a></p>
                </div>
                <hr/>
                <div id="sneezing">
                    <h1><a id="Medical_symptoms_0"></a>Medical symptoms</h1>
                    <p>The program shown below models the effect of flu and hay fever on the sneezing symptom.</p>
                    <h3><a id="Full_program_with_the_Prolog_editor_4"></a>Full program with the Prolog editor</h3>
                    <p>The first rule states that if somebody has flu, there is 30% probability that he has strong sneezing, 50% probability that he has moderate sneezing and 20% probability that he has no sneezing.
                        The second rule affirms that if somebody has hay fever, there is 20% probability that he has strong sneezing, 60% probability that she has moderate sneezing and 20% probability that he has no sneezing at all.
                        The next two facts are certain and they states that Bob has the flu and hay fever.</p>
                    <div class="nb-cell program prolog"><pre><code class="language-{.pl}"><span class="hljs-comment">% load the ‘pita’ library to perform inference</span>
:- <span class="hljs-atom">use_module</span>(<span class="hljs-atom">library</span>(<span class="hljs-atom">pita</span>)).
<span class="hljs-comment">% allows to create graphical results</span>
:- <span class="hljs-atom">if</span>(<span class="hljs-atom">current_predicate</span>(<span class="hljs-atom">use_rendering</span>/<span class="hljs-number">1</span>)).
:- <span class="hljs-atom">use_rendering</span>(<span class="hljs-atom">c3</span>).
:- <span class="hljs-atom">endif</span>.
:- <span class="hljs-atom">pita</span>.
<span class="hljs-comment">% to be written before the program</span>
:- <span class="hljs-atom">begin_lpad</span>.
<span class="hljs-comment">% Rules</span>
<span class="hljs-atom">strong_sneezing</span>(<span class="hljs-name">X</span>) : <span class="hljs-number">0.3</span> ; <span class="hljs-atom">moderate_sneezing</span>(<span class="hljs-name">X</span>) : <span class="hljs-number">0.5</span> :- <span class="hljs-atom">flu</span>(<span class="hljs-name">X</span>).
<span class="hljs-atom">strong_sneezing</span>(<span class="hljs-name">X</span>) : <span class="hljs-number">0.2</span> ; <span class="hljs-atom">moderate_sneezing</span>(<span class="hljs-name">X</span>) : <span class="hljs-number">0.6</span> :- <span class="hljs-atom">hay_fever</span>(<span class="hljs-name">X</span>).
<span class="hljs-comment">% Facts</span>
<span class="hljs-atom">flu</span>(<span class="hljs-atom">bob</span>).
<span class="hljs-atom">hay_fever</span>(<span class="hljs-atom">bob</span>).
<span class="hljs-comment">% to be written after the program</span>
:- <span class="hljs-atom">end_lpad</span>.
</code></pre></div>
                    <p>What is the probability that Bob has strong sneezing?</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">prob</span><span class="hljs-params">(strong_sneezing(bob)</span></span>, P).
</code></pre></div>
                    <p>Let us see the histogram</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">prob_bar</span><span class="hljs-params">(strong_sneezing(bob)</span></span>, P).
</code></pre></div>
                    <hr>
                    <p>Complete example: <a target="_blank" href="http://cplint.lamping.unife.it/example/inference/sneezing.pl">sneezing.pl</a></p>
                    <hr>
                    <p>This is again an example of a noisy or combining rule between the conclusions of two different clauses.</p>
                    <p>Complete example with the LPAD editor: <a target="_blank" href="http://cplint.lamping.unife.it/example/inference/sneezing.cpl">sneezing.cpl</a></p>
                    <hr>
                    <ul>
                        <li>Reference: F. Riguzzi and T. Swift. <em>The PITA system: Tabling and answer subsumption for reasoning under uncertainty</em>. Theory and Practice of Logic Programming, 27th International Conference on Logic Programming (ICLP’11) Special Issue, 11(4-5), pages 433-449, 2011.</li>
                    </ul>
                    <hr>
                    <p><a href="#index">Back to Index</a></p>

                </div>
                <hr/>
                <div id="coinmc">
                    <h1><a id="Coin_approximate_inference_variant_0"></a>Coin (approximate inference variant)</h1>
                    <p>The LPAD of this example is the same of the one shown <a href="#coin">here</a>, the only difference is the inference approach. In this example we will show how to perform an approximate inference with Monte Carlo sampling.</p>
                    <p>Let us suppose that we have one coin that we are not sure if it is biased. Now, if we toss the coin, what is the probability that it will land on head?</p>
                    <h2><a id="Perfom_approximate_inference_6"></a>Perfom approximate inference</h2>
                    <p>To perform approximate we just need to load the library <code>mcintyre</code> instead of <code>pita</code> and to initialize it we need to write down the goal <code>:- mc.</code>. Except for query commands the rest is the same as we are performing exact inference.</p>
                    <h2><a id="Full_program_9"></a>Full program</h2>
                    <p>Below the full LPAD of the example</p>
                    <div class="nb-cell program prolog"><pre><code class="language-{.pl}"><span class="hljs-comment">% load the library ‘mcintyre’ to perform approximate inference</span>
:- <span class="hljs-atom">use_module</span>(<span class="hljs-atom">library</span>(<span class="hljs-atom">mcintyre</span>)).
<span class="hljs-comment">% initialize the library ‘mcintyre’</span>
:- <span class="hljs-atom">mc</span>.
<span class="hljs-comment">% load the renderer ‘c3’ for graphical results</span>
:- <span class="hljs-atom">use_rendering</span>(<span class="hljs-atom">c3</span>).
<span class="hljs-comment">% to be written before the program</span>
:- <span class="hljs-atom">begin_lpad</span>.
<span class="hljs-comment">% Rules</span>
<span class="hljs-atom">heads</span>(<span class="hljs-name">Coin</span>): <span class="hljs-number">1</span>/<span class="hljs-number">2</span>; <span class="hljs-atom">tails</span>(<span class="hljs-name">Coin</span>) : <span class="hljs-number">1</span>/<span class="hljs-number">2</span> :- <span class="hljs-atom">toss</span>(<span class="hljs-name">Coin</span>),\+<span class="hljs-atom">biased</span>(<span class="hljs-name">Coin</span>).
<span class="hljs-atom">heads</span>(<span class="hljs-name">Coin</span>): <span class="hljs-number">0.6</span> ; <span class="hljs-atom">tails</span>(<span class="hljs-name">Coin</span>) : <span class="hljs-number">0.4</span> :- <span class="hljs-atom">toss</span>(<span class="hljs-name">Coin</span>),<span class="hljs-atom">biased</span>(<span class="hljs-name">Coin</span>).
<span class="hljs-comment">% Facts</span>
<span class="hljs-atom">fair</span>(<span class="hljs-name">Coin</span>): <span class="hljs-number">0.9</span> ; <span class="hljs-atom">biased</span>(<span class="hljs-name">Coin</span>): <span class="hljs-number">0.1</span>.
<span class="hljs-atom">toss</span>(<span class="hljs-atom">coin</span>).
<span class="hljs-comment">% to be written after the program</span>
:- <span class="hljs-atom">end_lpad</span>.
</code></pre></div>
                    <p>To execute queries we must use the predicates <code>mc_prob/2</code> for approximate inference and <code>mc_prob_bar/2</code> for approximate inference with graphical results. For example if we want to ask for the probability that the coin will land on heads</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">mc_prob</span><span class="hljs-params">(heads(coin)</span></span>,P).
</code></pre></div>
                    <p>and for graphical results</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">mc_prob_bar</span><span class="hljs-params">(heads(coin)</span></span>,P).
</code></pre></div>
                    <p>With MCINTYRE, you can also take a given number of sample with</p>
                    <pre><code class="language-{.pl}">mc_sample(:<span class="hljs-string">Query:</span>atom,+<span class="hljs-string">Samples:</span><span class="hljs-typename">int</span>,-<span class="hljs-string">Successes:</span><span class="hljs-typename">int</span>,-<span class="hljs-string">Failures:</span><span class="hljs-typename">int</span>,-<span class="hljs-string">Probability:</span><span class="hljs-typename">float</span>).
</code></pre>
                    <p>For example this query</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">mc_sample</span><span class="hljs-params">(heads(coin)</span></span>,<span class="hljs-number">1000</span>,S,F,P).
</code></pre></div>
                    <p>samples heads(coin) 1000 times and returns in T the number of successes, in F the number of failures and in P the estimated probability (T/1000).</p>
                    <p>We can obtain a bar chart of the samples with the predicate mc_sample_bar/3 (<strong>note:</strong> remember to load the renderer <code>c3</code>)</p>
                    <pre><code class="language-{.pl}">mc_sample_bar(<span class="hljs-symbol">:Query</span><span class="hljs-symbol">:atom</span>,+<span class="hljs-constant">Samples</span><span class="hljs-symbol">:int</span>,-<span class="hljs-constant">Chart</span><span class="hljs-symbol">:dict</span>).
</code></pre>
                    <p>In our example</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">mc_sample_bar</span><span class="hljs-params">(heads(coin)</span></span>,<span class="hljs-number">1000</span>,Chart).
</code></pre></div>

                    <p>Differently from exact inference, 
                        in approximate inference the query can be a conjunction 
                        of atoms.</p>
                    <hr>
                    <p>Complete example: <a target="_blank" href="http://cplint.lamping.unife.it/example/inference/coinmc.pl">coinmc.pl</a></p>
                    <hr>
                    <ul>
                        <li>Reference: J. Vennekens, S. Verbaeten, and M. Bruynooghe. <em>Logic programs with annotated disjunctions</em>. In International Conference on Logic Programming, volume 3131 of LNCS, pages 195-209. Springer, 2004.</li>
                    </ul>
                    <p>
                        <a href="#index">Back to Index</a></p>

                </div>
                <hr/>
                <div id="markov_chain">
                    <h1><a id="Markov_Chain_0"></a>Markov Chain</h1>
                    <p>In this example we want to know what is the likelihood that on an execution of a Markov chain from a start state ‘s’, a final state ‘t’ will be reached?
                        The chains may be infinite so the query may have an infinite number of explanations and if we want exact inference and use PITA, the inference may not terminate. To ensure termination, we have two solutions. We may either fix a bound on the depth of the derivations of PITA by setting the parameters</p>
                    <pre><code class="language-{.pl}">:- <span class="hljs-function"><span class="hljs-title">set_pita</span><span class="hljs-params">(depth_bound,true)</span></span>.
:- <span class="hljs-function"><span class="hljs-title">set_pita</span><span class="hljs-params">(depth,&lt;level of depth (integer)</span></span>&gt;).
</code></pre>
                    <p>(see <a target="_blank" href="http://cplint.lamping.unife.it/example/inference/markov_chaindb.pl">exact inference variant of this example</a>). Alternatively, MCINTYRE can be used.</p>
                    <p>Here we will use the latter approach.</p>
                    <h2><a id="Full_program_12"></a>Full program</h2>
                    <p>Below the full program of this example is shown</p>
                    <div class="nb-cell program prolog"><p>
                        <pre><code class="language-{.pl}"><span class="hljs-comment">% load the library ‘mcintyre’ to perform approximate inference</span>
:- <span class="hljs-atom">use_module</span>(<span class="hljs-atom">library</span>(<span class="hljs-atom">mcintyre</span>)).
<span class="hljs-comment">% load the renderer ‘c3’ for graphical results</span>
:- <span class="hljs-atom">use_rendering</span>(<span class="hljs-atom">c3</span>).
<span class="hljs-comment">% initialize the library 'mcintyre'</span>
:- <span class="hljs-atom">mc</span>.
<span class="hljs-comment">% to be written before the program</span>
:- <span class="hljs-atom">begin_lpad</span>.
<span class="hljs-atom">reach</span>(<span class="hljs-name">S</span>, <span class="hljs-name">I</span>, <span class="hljs-name">T</span>) :-
<span class="hljs-atom">trans</span>(<span class="hljs-name">S</span>, <span class="hljs-name">I</span>, <span class="hljs-name">U</span>),
<span class="hljs-atom">reach</span>(<span class="hljs-name">U</span>, <span class="hljs-atom">next</span>(<span class="hljs-name">I</span>), <span class="hljs-name">T</span>).
<span class="hljs-atom">reach</span>(<span class="hljs-name">S</span>, <span class="hljs-name">_</span>, <span class="hljs-name">S</span>).
<span class="hljs-atom">trans</span>(<span class="hljs-atom">s0</span>,<span class="hljs-name">S</span>,<span class="hljs-atom">s0</span>):<span class="hljs-number">0.5</span>; <span class="hljs-atom">trans</span>(<span class="hljs-atom">s0</span>,<span class="hljs-name">S</span>,<span class="hljs-atom">s1</span>):<span class="hljs-number">0.3</span>; <span class="hljs-atom">trans</span>(<span class="hljs-atom">s0</span>,<span class="hljs-name">S</span>,<span class="hljs-atom">s2</span>):<span class="hljs-number">0.2</span>.
<span class="hljs-atom">trans</span>(<span class="hljs-atom">s1</span>,<span class="hljs-name">S</span>,<span class="hljs-atom">s1</span>):<span class="hljs-number">0.4</span>; <span class="hljs-atom">trans</span>(<span class="hljs-atom">s1</span>,<span class="hljs-name">S</span>,<span class="hljs-atom">s3</span>):<span class="hljs-number">0.1</span>; <span class="hljs-atom">trans</span>(<span class="hljs-atom">s1</span>,<span class="hljs-name">S</span>,<span class="hljs-atom">s4</span>):<span class="hljs-number">0.5</span>.
<span class="hljs-atom">trans</span>(<span class="hljs-atom">s4</span>,<span class="hljs-name">_</span>,<span class="hljs-atom">s3</span>).
<span class="hljs-comment">% to be written after the program</span>
:- <span class="hljs-atom">end_lpad</span>.
</code></pre></div>
                    <p>We ask for the probability that starting at state ‘s0’ at instance 0, state ‘s3’ is reachable</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">mc_prob</span><span class="hljs-params">(reach(s0,<span class="hljs-number">0</span>,s3)</span></span>,P).
</code></pre></div>
                    <p>if we want to see the probability histogram</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">mc_prob_bar</span><span class="hljs-params">(reach(s0,<span class="hljs-number">0</span>,s3)</span></span>,P).
</code></pre></div>
                    <p>Then if we want to sample <code>reach(s0,0,s3)</code> 1000 times, we can do it with</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">mc_sample</span><span class="hljs-params">(reach(s0,<span class="hljs-number">0</span>,s3)</span></span>,<span class="hljs-number">1000</span>,S,F,P).
</code></pre></div>
                    <p>If we want to see the bar graph of the sampling</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">mc_sample_bar</span><span class="hljs-params">(reach(s0,<span class="hljs-number">0</span>,s3)</span></span>,<span class="hljs-number">1000</span>,Chart).
</code></pre></div>
                    <p>We can also sample arguments of queries with the predicate <code>mc_sample_arg/4</code></p>
                    <pre><code class="language-{.pl}">mc_sample_arg(<span class="hljs-symbol">:Query</span><span class="hljs-symbol">:atom</span>,+<span class="hljs-constant">Samples</span><span class="hljs-symbol">:int</span>,?<span class="hljs-constant">Arg</span><span class="hljs-symbol">:var</span>,-<span class="hljs-constant">Values</span><span class="hljs-symbol">:list</span>).
</code></pre>
                    <p>The predicate samples <code>Query</code> a number of <code>Samples</code> times. <code>Arg</code> should be a variable in <code>Query</code>.
                        The predicate returns in <code>Values</code> a list of couples <code>L-N</code> where <code>L</code> is the list of
                        values of <code>Arg</code> for which <code>Query</code> succeeds in world sampled at random and
                        <code>N</code> is the number of samples. If <code>L</code> is the empty list, it means that for that sample the query failed.
                        If <code>L</code> is a list with a
                        single element, it means that for that sample the query is
                        determinate.
                        If, in all couples <code>L-N</code>, <code>L</code>
                        is a list with a
                        single element, it means that the clauses in the program
                        are mutually exclusive, i.e., that in every sample,
                        only one clause for each subgoal has the body true.</p>
                    <p>So for example we may sample the argument <code>S</code> of reach(s0,0,S) with</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">mc_sample_arg</span><span class="hljs-params">(reach(s0,<span class="hljs-number">0</span>,S)</span></span>,<span class="hljs-number">50</span>,S,Values).
</code></pre></div>
                    <p>If we want to see the bar graph of this sampling we use the predicate <code>mc_sample_arg_bar/4</code></p>
                    <pre><code class="language-{.pl}">mc_sample_arg_bar(<span class="hljs-symbol">:Query</span><span class="hljs-symbol">:atom</span>,+<span class="hljs-constant">Samples</span><span class="hljs-symbol">:int</span>,?<span class="hljs-constant">Arg</span><span class="hljs-symbol">:var</span>,-<span class="hljs-constant">Chart</span><span class="hljs-symbol">:dict</span>).
</code></pre>
                    <p>For example</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">mc_sample_arg_bar</span><span class="hljs-params">(reach(s0,<span class="hljs-number">0</span>,S)</span></span>,<span class="hljs-number">50</span>,S,Chart).
</code></pre></div>
                    <p>Moreover, we can sample arguments of queries with the predicate <code>mc_sample_arg_first/4</code></p>
                    <pre><code class="language-{.pl}">mc_sample_arg_first<span class="hljs-list">(<span class="hljs-keyword">:Query</span><span class="hljs-keyword">:atom</span>,+Samples<span class="hljs-keyword">:int</span>,?Arg<span class="hljs-keyword">:var</span>,-Values<span class="hljs-keyword">:list</span>)</span>
</code></pre>
                    <p>that returns in <code>Values</code> a list of couples <code>V-N</code> where
                        <code>V</code> is the value of <code>Arg</code> returned as the first answer by <code>Query</code> in
                        a world sampled at random and <code>N</code> is the number of samples
                        returning that value.
                        <code>V</code> is <code>failure</code> if the query fails.
                        <code>mc_sample_arg_first/4</code> differs from <code>mc_sample_arg/4</code> because the first just computes the first answer of the query for each sampled world.</p>
                    <p>So for example we may sample 50 times the first answer for <code>S</code> in <code>reach(s0,0,S)</code> with</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">mc_sample_arg_first</span><span class="hljs-params">(reach(s0,<span class="hljs-number">0</span>,S)</span></span>,<span class="hljs-number">50</span>,S,Values).
</code></pre></div>
                    <hr>
                    <p>Complete example: <a target="_blank" href="http://cplint.lamping.unife.it/example/inference/markov_chain.pl">markov_chain.pl</a></p>
                    <hr>
                    <ul>
                        <li>Reference: Gorlin, Andrey, C. R. Ramakrishnan, and Scott A. Smolka. <em>Model checking with probabilistic tabled logic programming</em>. Theory and Practice of Logic Programming 12.4-5 (2012).</li>
                    </ul>
                    <hr>
                    <p><a href="#index">Back to Index</a></p>

                </div>
                <hr/>
                <div id="pctl_slep">
                    <h1><a id="Probabilistic_Computation_Tree_Logic_0"></a>Probabilistic Computation Tree Logic</h1>
                    <p>In this example we want to perform model checking of the Synchronous Leader Election Protocol expressed in Probabilistic Computation Tree Logic (PCTL).</p>
                    <p>This example shows the computation of expectations and the possibility of mixing
                        LPADs and Prolog for drawing diagrams.</p>
                    <p>Given a synchronous ring of N processes the Synchronous Leader Election Protocol is used to elect a leader (a uniquely designated processor) by sending messages around the ring.</p>
                    <p>The protocol proceeds in rounds and is parametrised by a constant K. Each round begins by all processors (independently) choosing a random number (uniformly) from {1,…,K} as an id. The processors then pass their ids around the ring. If there is a unique id, then the processor with the maximum unique id is elected the leader, and otherwise the processors begin a new round.</p>
                    <p>With this program you can</p>
                    <ul>
                        <li>check that the probability of eventually electing a leader is 1</li>
                        <li>compute the probability of electing a leader within a certain
                            number of rounds</li>
                        <li>compute the expected number of rounds to elect a leader</li>
                        <li>graph the probability of electing a leader within L rounds as a function of L</li>
                        <li>graph the expected number of rounds to elect a leader as a function of the
                            number of processes or of K</li>
                    </ul>
                    <h2><a id="Full_program_20"></a>Full program</h2>
                    <p>The full program of this example is</p>
                    <div class="nb-cell program prolog" code="https://raw.githubusercontent.com/friguzzi/swish/master/examples/inference/pctl_slep.pl" data-singleline="true"><pre><code class="language-{.pl}">:- <span class="hljs-atom">use_module</span>(<span class="hljs-atom">library</span>(<span class="hljs-atom">mcintyre</span>)).

:- <span class="hljs-atom">if</span>(<span class="hljs-atom">current_predicate</span>(<span class="hljs-atom">use_rendering</span>/<span class="hljs-number">1</span>)).
:- <span class="hljs-atom">use_rendering</span>(<span class="hljs-atom">c3</span>).
:- <span class="hljs-atom">endif</span>.
:- <span class="hljs-atom">dynamic</span> <span class="hljs-atom">kr</span>/<span class="hljs-number">1</span>,<span class="hljs-atom">num</span>/<span class="hljs-number">1.</span>
:- <span class="hljs-atom">mc</span>.

:- <span class="hljs-atom">begin_lpad</span>.

<span class="hljs-comment">% State Formulae </span>
<span class="hljs-atom">models</span>(<span class="hljs-name">_S</span>, <span class="hljs-atom">tt</span>,<span class="hljs-name">_Hist</span>,<span class="hljs-name">_Limit</span>,<span class="hljs-name">_Time</span>).
<span class="hljs-atom">models</span>(<span class="hljs-name">S</span>, <span class="hljs-atom">prop</span>(<span class="hljs-name">P</span>),<span class="hljs-name">_Hist</span>,<span class="hljs-name">_Limit</span>,<span class="hljs-name">_Time</span>) :-
    <span class="hljs-atom">proposition</span>(<span class="hljs-name">P</span>, <span class="hljs-name">S</span>).
<span class="hljs-atom">models</span>(<span class="hljs-name">S</span>, <span class="hljs-atom">and</span>(<span class="hljs-name">F1</span>, <span class="hljs-name">F2</span>),<span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time</span>) :-
    <span class="hljs-atom">models</span>(<span class="hljs-name">S</span>, <span class="hljs-name">F1</span>,<span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time</span>), <span class="hljs-atom">models</span>(<span class="hljs-name">S</span>, <span class="hljs-name">F2</span>,<span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time</span>).
<span class="hljs-atom">models</span>(<span class="hljs-name">S</span>, <span class="hljs-atom">or</span>(<span class="hljs-name">F1</span>, <span class="hljs-name">_F2</span>),<span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time</span>) :-
    <span class="hljs-atom">models</span>(<span class="hljs-name">S</span>, <span class="hljs-name">F1</span>,<span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time</span>).
<span class="hljs-atom">models</span>(<span class="hljs-name">S</span>, <span class="hljs-atom">or</span>(<span class="hljs-name">F1</span>, <span class="hljs-name">F2</span>),<span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time</span>) :-
    \+ <span class="hljs-atom">models</span>(<span class="hljs-name">S</span>, <span class="hljs-name">F1</span>,<span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time</span>),
    <span class="hljs-atom">models</span>(<span class="hljs-name">S</span>, <span class="hljs-name">F2</span>,<span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time</span>).
<span class="hljs-atom">models</span>(<span class="hljs-name">S</span>, <span class="hljs-atom">not</span>(<span class="hljs-name">F</span>), <span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time</span>) :-
    \+ <span class="hljs-atom">models</span>(<span class="hljs-name">S</span>, <span class="hljs-name">F</span>,<span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time</span>).
<span class="hljs-atom">models</span>(<span class="hljs-name">S</span>, <span class="hljs-atom">prob_until</span>(<span class="hljs-atom">comp</span>(<span class="hljs-name">Op</span>, <span class="hljs-name">P</span>), <span class="hljs-name">F1</span>, <span class="hljs-name">F2</span>),<span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time</span>) :-
    <span class="hljs-atom">mc_sample</span>(<span class="hljs-atom">pmodels</span>(<span class="hljs-name">S</span>, <span class="hljs-atom">until</span>(<span class="hljs-name">F1</span>, <span class="hljs-name">F2</span>),<span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time</span>),<span class="hljs-number">20</span>, <span class="hljs-name">Q</span>),
    <span class="hljs-atom">comp</span>(<span class="hljs-name">Q</span>, <span class="hljs-name">Op</span>, <span class="hljs-name">P</span>).
<span class="hljs-atom">models</span>(<span class="hljs-name">S</span>, <span class="hljs-atom">prob_next</span>(<span class="hljs-atom">comp</span>(<span class="hljs-name">Op</span>, <span class="hljs-name">P</span>), <span class="hljs-name">F</span>),<span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time</span>) :-
    <span class="hljs-atom">mc_sample</span>(<span class="hljs-atom">pmodels</span>(<span class="hljs-name">S</span>, <span class="hljs-atom">next</span>(<span class="hljs-name">F</span>),<span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time</span>),<span class="hljs-number">20</span>, <span class="hljs-name">Q</span>),
    <span class="hljs-atom">comp</span>(<span class="hljs-name">Q</span>, <span class="hljs-name">Op</span>, <span class="hljs-name">P</span>).

<span class="hljs-atom">comp</span>(<span class="hljs-name">Q</span>,&gt;,<span class="hljs-name">P</span>):-
  <span class="hljs-name">Q</span>&gt;<span class="hljs-name">P</span>.

<span class="hljs-atom">comp</span>(<span class="hljs-name">Q</span>,&gt;=,<span class="hljs-name">P</span>):-
  <span class="hljs-name">Q</span>&gt;=<span class="hljs-name">P</span>.

<span class="hljs-atom">comp</span>(<span class="hljs-name">Q</span>,&lt;,<span class="hljs-name">P</span>):-
  <span class="hljs-name">Q</span>&lt;<span class="hljs-name">P</span>.

<span class="hljs-atom">comp</span>(<span class="hljs-name">Q</span>,=&lt;,<span class="hljs-name">P</span>):-
  <span class="hljs-name">Q</span>=&lt;<span class="hljs-name">P</span>.


<span class="hljs-comment">% Path Formulae</span>
<span class="hljs-atom">pmodels</span>(<span class="hljs-name">S</span>,<span class="hljs-name">F</span>):-
  <span class="hljs-atom">pmodels</span>(<span class="hljs-name">S</span>,<span class="hljs-name">F</span>,[],<span class="hljs-atom">nolimit</span>,<span class="hljs-number">0</span>,<span class="hljs-name">_Time</span>).

<span class="hljs-atom">pmodels</span>(<span class="hljs-name">S</span>,<span class="hljs-name">F</span>,<span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time</span>):-
  <span class="hljs-atom">pmodels</span>(<span class="hljs-name">S</span>,<span class="hljs-name">F</span>,<span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time</span>,<span class="hljs-name">_Time</span>).

<span class="hljs-atom">pmodels</span>(<span class="hljs-name">S</span>, <span class="hljs-atom">until</span>(<span class="hljs-name">_F1</span>, <span class="hljs-name">F2</span>),<span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time</span>,<span class="hljs-name">Time</span>) :-
    <span class="hljs-atom">models</span>(<span class="hljs-name">S</span>, <span class="hljs-name">F2</span>,<span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time</span>),!.
    
<span class="hljs-atom">pmodels</span>(<span class="hljs-name">S</span>, <span class="hljs-atom">until</span>(<span class="hljs-name">F1</span>, <span class="hljs-name">F2</span>),<span class="hljs-name">Hist0</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time0</span>,<span class="hljs-name">Time</span>) :-
    <span class="hljs-atom">within_limit</span>(<span class="hljs-name">Time0</span>,<span class="hljs-name">Limit</span>),
    <span class="hljs-atom">models</span>(<span class="hljs-name">S</span>, <span class="hljs-name">F1</span>,<span class="hljs-name">Hist0</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time0</span>),
    <span class="hljs-atom">ctrans</span>(<span class="hljs-name">S</span>, <span class="hljs-name">_</span>, <span class="hljs-name">T</span>, <span class="hljs-name">Hist0</span>, <span class="hljs-name">Hist</span>),!,
    <span class="hljs-name">Time1</span> <span class="hljs-atom">is</span> <span class="hljs-name">Time0</span>+<span class="hljs-number">1</span>,
    <span class="hljs-atom">pmodels</span>(<span class="hljs-name">T</span>, <span class="hljs-atom">until</span>(<span class="hljs-name">F1</span>,<span class="hljs-name">F2</span>),<span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time1</span>,<span class="hljs-name">Time</span>).

<span class="hljs-atom">pmodels</span>(<span class="hljs-name">S</span>, <span class="hljs-atom">next</span>(<span class="hljs-name">F</span>), <span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time0</span>,<span class="hljs-name">Time</span>) :-
    <span class="hljs-atom">within_limit</span>(<span class="hljs-name">Time0</span>,<span class="hljs-name">Limit</span>),
    <span class="hljs-atom">ctrans</span>(<span class="hljs-name">S</span>, <span class="hljs-name">_</span>, <span class="hljs-name">T</span>, <span class="hljs-name">Hist</span>, <span class="hljs-name">_</span>),!,
    <span class="hljs-name">Time</span> <span class="hljs-atom">is</span> <span class="hljs-name">Time0</span>+<span class="hljs-number">1</span>,
    <span class="hljs-atom">models</span>(<span class="hljs-name">T</span>, <span class="hljs-name">F</span>,<span class="hljs-name">Hist</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">Time</span>).

<span class="hljs-atom">within_limit</span>(<span class="hljs-name">_Time</span>,<span class="hljs-atom">nolimit</span>):-!.

<span class="hljs-atom">within_limit</span>(<span class="hljs-name">Time</span>,<span class="hljs-name">Limit</span>):-
  <span class="hljs-name">Time</span>&lt;<span class="hljs-name">Limit</span>.

<span class="hljs-atom">bounded_eventually</span>(<span class="hljs-name">Prop</span>,<span class="hljs-name">Rounds</span>):-
  <span class="hljs-atom">num</span>(<span class="hljs-name">N</span>),
  <span class="hljs-name">B</span> <span class="hljs-atom">is</span> <span class="hljs-name">Rounds</span>*(<span class="hljs-name">N</span>+<span class="hljs-number">1</span>),
  <span class="hljs-atom">eventually</span>(<span class="hljs-name">Prop</span>,<span class="hljs-name">B</span>,<span class="hljs-name">_T</span>).

<span class="hljs-atom">eventually</span>(<span class="hljs-name">Prop</span>):-
  <span class="hljs-atom">eventually</span>(<span class="hljs-name">Prop</span>,<span class="hljs-name">_T</span>).

<span class="hljs-atom">eventually</span>(<span class="hljs-name">Prop</span>,<span class="hljs-name">Rounds</span>):-
  <span class="hljs-atom">eventually</span>(<span class="hljs-name">Prop</span>,<span class="hljs-atom">nolimit</span>,<span class="hljs-name">T</span>),
  <span class="hljs-atom">num</span>(<span class="hljs-name">N</span>),
  <span class="hljs-name">Rounds</span> <span class="hljs-atom">is</span> <span class="hljs-name">T</span>/(<span class="hljs-name">N</span>+<span class="hljs-number">1</span>).

<span class="hljs-atom">eventually</span>(<span class="hljs-name">Prop</span>,<span class="hljs-name">Limit</span>,<span class="hljs-name">T</span>) :-
    <span class="hljs-atom">init</span>(<span class="hljs-name">S</span>),
    <span class="hljs-atom">pctlspec</span>(<span class="hljs-name">Prop</span>, <span class="hljs-name">F</span>),
    <span class="hljs-atom">pmodels</span>(<span class="hljs-name">S</span>, <span class="hljs-name">F</span>,[],<span class="hljs-name">Limit</span>,<span class="hljs-number">0</span>,<span class="hljs-name">T</span>).


<span class="hljs-atom">pctlspec</span>(<span class="hljs-name">X</span>, <span class="hljs-atom">until</span>(<span class="hljs-atom">tt</span>, <span class="hljs-atom">prop</span>(<span class="hljs-name">X</span>))).
<span class="hljs-atom">proposition</span>(<span class="hljs-name">P</span>, <span class="hljs-name">S</span>) :- <span class="hljs-atom">final</span>(<span class="hljs-name">P</span>, <span class="hljs-name">S</span>).

<span class="hljs-atom">final</span>(<span class="hljs-atom">elect</span>, [<span class="hljs-name">_</span>|<span class="hljs-name">L</span>]) :-
    <span class="hljs-atom">num</span>(<span class="hljs-name">N</span>),
    <span class="hljs-atom">gen_elected_state</span>(<span class="hljs-name">N</span>, <span class="hljs-name">L</span>).

<span class="hljs-atom">gen_elected_state</span>(<span class="hljs-name">J</span>, <span class="hljs-name">L</span>) :-
    (<span class="hljs-name">J</span>==<span class="hljs-number">0</span>
    -&gt;    <span class="hljs-name">L</span>=[]
    ;     <span class="hljs-name">L</span> = [<span class="hljs-atom">state</span>(<span class="hljs-number">3</span>,<span class="hljs-name">_</span>,<span class="hljs-name">_</span>,<span class="hljs-name">_</span>)|<span class="hljs-name">Rest</span>],
          <span class="hljs-name">J1</span> <span class="hljs-atom">is</span> <span class="hljs-name">J</span>-<span class="hljs-number">1</span>,
          <span class="hljs-atom">gen_elected_state</span>(<span class="hljs-name">J1</span>,<span class="hljs-name">Rest</span>)
    ).
    

<span class="hljs-comment">% transitions</span>
<span class="hljs-comment">% module counter</span>
<span class="hljs-comment">% [read] c&lt;N-1 -&gt; (c'=c+1);</span>
<span class="hljs-comment">% reading</span>
<span class="hljs-atom">trans</span>(<span class="hljs-atom">counter</span>, <span class="hljs-atom">counter</span>(<span class="hljs-name">C</span>), <span class="hljs-atom">read</span>, <span class="hljs-atom">counter</span>(<span class="hljs-name">D</span>),<span class="hljs-name">_S</span>,<span class="hljs-name">H</span>,<span class="hljs-name">H</span>) :-
  <span class="hljs-atom">num</span>(<span class="hljs-name">N</span>),
  <span class="hljs-name">C</span> &lt; <span class="hljs-name">N</span>-<span class="hljs-number">1</span>,
  <span class="hljs-name">D</span> <span class="hljs-atom">is</span> <span class="hljs-name">C</span>+<span class="hljs-number">1.</span>

<span class="hljs-comment">% [read] c=N-1 -&gt; (c'=c);</span>
<span class="hljs-comment">% finished reading</span>
<span class="hljs-atom">trans</span>(<span class="hljs-atom">counter</span>, <span class="hljs-atom">counter</span>(<span class="hljs-name">C</span>), <span class="hljs-atom">read</span>, <span class="hljs-atom">counter</span>(<span class="hljs-name">C</span>),<span class="hljs-name">_S</span>,<span class="hljs-name">H</span>,<span class="hljs-name">H</span>) :-
  <span class="hljs-atom">num</span>(<span class="hljs-name">N</span>),
  <span class="hljs-name">C</span> =:= <span class="hljs-name">N</span>-<span class="hljs-number">1.</span>

<span class="hljs-comment">% [done] u1 | u2 | u3 | u4 -&gt; (c'=c);</span>
<span class="hljs-comment">% done</span>
<span class="hljs-atom">trans</span>(<span class="hljs-atom">counter</span>, <span class="hljs-atom">counter</span>(<span class="hljs-name">C</span>), <span class="hljs-atom">done</span>, <span class="hljs-atom">counter</span>(<span class="hljs-name">C</span>),<span class="hljs-name">S</span>,<span class="hljs-name">H</span>,<span class="hljs-name">H</span>) :-
  <span class="hljs-atom">get_processid</span>(<span class="hljs-name">P</span>), 
  <span class="hljs-atom">nonlocal</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">P</span>,<span class="hljs-name">_</span>), <span class="hljs-atom">uniqueid</span>, <span class="hljs-number">1</span>,<span class="hljs-name">S</span>).
   

<span class="hljs-comment">% [retry] !(u1 | u2 | u3 | u4) -&gt; (c'=1);</span>
<span class="hljs-comment">% pick again reset counter </span>
<span class="hljs-atom">trans</span>(<span class="hljs-atom">counter</span>, <span class="hljs-atom">counter</span>(<span class="hljs-name">_C</span>), <span class="hljs-atom">retry</span>, <span class="hljs-atom">counter</span>(<span class="hljs-number">1</span>),<span class="hljs-name">S</span>,<span class="hljs-name">H</span>,<span class="hljs-name">H</span>) :-
        <span class="hljs-atom">findall</span>(<span class="hljs-name">P</span>,<span class="hljs-atom">get_processid</span>(<span class="hljs-name">P</span>),<span class="hljs-name">PL</span>),
    <span class="hljs-atom">maplist</span>(<span class="hljs-atom">nl</span>(<span class="hljs-name">S</span>),<span class="hljs-name">PL</span>).

<span class="hljs-comment">% [loop] s1=3 -&gt; (c'=c);</span>
<span class="hljs-comment">% loop (when finished to avoid deadlocks)</span>
<span class="hljs-atom">trans</span>(<span class="hljs-atom">counter</span>, <span class="hljs-atom">counter</span>(<span class="hljs-name">C</span>), <span class="hljs-atom">loop</span>, <span class="hljs-atom">counter</span>(<span class="hljs-name">C</span>),<span class="hljs-name">S</span>,<span class="hljs-name">H</span>,<span class="hljs-name">H</span>) :-
  <span class="hljs-atom">nonlocal</span>(<span class="hljs-atom">process</span>(<span class="hljs-number">1</span>,<span class="hljs-name">_</span>), <span class="hljs-atom">state</span>, <span class="hljs-number">3</span>,<span class="hljs-name">S</span>).

<span class="hljs-comment">% module process</span>
<span class="hljs-comment">% local state</span>
<span class="hljs-comment">% s1=0 make random choice</span>
<span class="hljs-comment">% s1=1 reading</span>
<span class="hljs-comment">% s1=2 deciding</span>
<span class="hljs-comment">% s1=3 finished</span>

<span class="hljs-comment">% [pick] s1=0 -&gt; 1/K : (s1'=1) &amp; (p1'=0) &amp; (v1'=0) &amp; (u1'=true) + ...;</span>
<span class="hljs-comment">% pick value</span>
<span class="hljs-atom">trans</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">_N</span>,<span class="hljs-name">_Next</span>), <span class="hljs-atom">state</span>(<span class="hljs-number">0</span>,<span class="hljs-name">_</span>,<span class="hljs-name">_</span>,<span class="hljs-name">_</span>), <span class="hljs-atom">pick</span>, <span class="hljs-atom">state</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-name">R</span>,<span class="hljs-name">R</span>),<span class="hljs-name">_S</span>,<span class="hljs-name">H</span>,[<span class="hljs-atom">pick</span>(<span class="hljs-name">R</span>)|<span class="hljs-name">H</span>]) :-
  <span class="hljs-atom">pick</span>(<span class="hljs-name">H</span>,<span class="hljs-name">R</span>).

<span class="hljs-comment">%read </span>
<span class="hljs-comment">% [read] s1=1 &amp;  u1 &amp; !p1=v2 &amp; c&lt;N-1 -&gt; (u1'=true) &amp; (v1'=v2);</span>
<span class="hljs-atom">trans</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">_N</span>,<span class="hljs-name">Next</span>), <span class="hljs-atom">state</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-name">_</span>,<span class="hljs-name">P</span>), <span class="hljs-atom">read</span>, <span class="hljs-atom">state</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-name">V</span>,<span class="hljs-name">P</span>),<span class="hljs-name">S</span>,<span class="hljs-name">H</span>,<span class="hljs-name">H</span>) :-
  <span class="hljs-atom">nonlocal</span>(<span class="hljs-atom">counter</span>, <span class="hljs-atom">counter</span>, <span class="hljs-name">C</span>,<span class="hljs-name">S</span>),
  <span class="hljs-atom">num</span>(<span class="hljs-name">CN</span>),
  <span class="hljs-name">C</span> &lt; <span class="hljs-name">CN</span> - <span class="hljs-number">1</span>,
  <span class="hljs-atom">nonlocal</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">Next</span>,<span class="hljs-name">_</span>), <span class="hljs-atom">value</span>, <span class="hljs-name">V</span>,<span class="hljs-name">S</span>),
  <span class="hljs-name">P</span> \== <span class="hljs-name">V</span>.

<span class="hljs-comment">% [read] s1=1 &amp;  u1 &amp;  p1=v2 &amp; c&lt;N-1 -&gt; (u1'=false) &amp; (v1'=v2) &amp; (p1'=0);</span>
<span class="hljs-atom">trans</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">_N</span>,<span class="hljs-name">Next</span>), <span class="hljs-atom">state</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-name">_</span>,<span class="hljs-name">P</span>), <span class="hljs-atom">read</span>, <span class="hljs-atom">state</span>(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-name">V</span>,<span class="hljs-number">0</span>),<span class="hljs-name">S</span>,<span class="hljs-name">H</span>,<span class="hljs-name">H</span>) :-
  <span class="hljs-atom">nonlocal</span>(<span class="hljs-atom">counter</span>, <span class="hljs-atom">counter</span>, <span class="hljs-name">C</span>,<span class="hljs-name">S</span>),
  <span class="hljs-atom">num</span>(<span class="hljs-name">CN</span>),
  <span class="hljs-name">C</span> &lt; <span class="hljs-name">CN</span> - <span class="hljs-number">1</span>,
  <span class="hljs-atom">nonlocal</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">Next</span>,<span class="hljs-name">_</span>), <span class="hljs-atom">value</span>, <span class="hljs-name">V</span>,<span class="hljs-name">S</span>),
  <span class="hljs-name">P</span> == <span class="hljs-name">V</span>.

<span class="hljs-comment">% [read] s1=1 &amp; !u1 &amp;  c&lt;N-1 -&gt; (u1'=false) &amp; (v1'=v2);</span>
<span class="hljs-atom">trans</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">_N</span>,<span class="hljs-name">Next</span>), <span class="hljs-atom">state</span>(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-name">_</span>,<span class="hljs-name">P</span>), <span class="hljs-atom">read</span>, <span class="hljs-atom">state</span>(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-name">V</span>,<span class="hljs-name">P</span>),<span class="hljs-name">S</span>,<span class="hljs-name">H</span>,<span class="hljs-name">H</span>) :-
  <span class="hljs-atom">nonlocal</span>(<span class="hljs-atom">counter</span>, <span class="hljs-atom">counter</span>, <span class="hljs-name">C</span>,<span class="hljs-name">S</span>),
  <span class="hljs-atom">num</span>(<span class="hljs-name">CN</span>),
  <span class="hljs-name">C</span> &lt; <span class="hljs-name">CN</span> - <span class="hljs-number">1</span>,
  <span class="hljs-atom">nonlocal</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">Next</span>,<span class="hljs-name">_</span>), <span class="hljs-atom">value</span>, <span class="hljs-name">V</span>,<span class="hljs-name">S</span>).
 
<span class="hljs-comment">% read and move to decide </span>
<span class="hljs-comment">% [read] s1=1 &amp;  u1 &amp; !p1=v2 &amp; c=N-1 -&gt; (s1'=2) &amp; (u1'=true) &amp; (v1'=0) &amp; (p1'=0);</span>
<span class="hljs-atom">trans</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">_N</span>,<span class="hljs-name">Next</span>), <span class="hljs-atom">state</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-name">_</span>,<span class="hljs-name">P</span>), <span class="hljs-atom">read</span>, <span class="hljs-atom">state</span>(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>),<span class="hljs-name">S</span>,<span class="hljs-name">H</span>,<span class="hljs-name">H</span>) :-
  <span class="hljs-atom">nonlocal</span>(<span class="hljs-atom">counter</span>, <span class="hljs-atom">counter</span>, <span class="hljs-name">C</span>,<span class="hljs-name">S</span>),
  <span class="hljs-atom">num</span>(<span class="hljs-name">CN</span>),
  <span class="hljs-name">C</span> =:= <span class="hljs-name">CN</span> - <span class="hljs-number">1</span>,
  <span class="hljs-atom">nonlocal</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">Next</span>,<span class="hljs-name">_</span>), <span class="hljs-atom">value</span>, <span class="hljs-name">V</span>,<span class="hljs-name">S</span>),
  <span class="hljs-name">P</span> \== <span class="hljs-name">V</span>.

<span class="hljs-comment">% [read] s1=1 &amp;  u1 &amp;  p1=v2 &amp; c=N-1 -&gt; (u1'=false) &amp; (v1'=0) &amp; (p1'=0);</span>
<span class="hljs-atom">trans</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">_N</span>,<span class="hljs-name">Next</span>), <span class="hljs-atom">state</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-name">_</span>,<span class="hljs-name">P</span>), <span class="hljs-atom">read</span>, <span class="hljs-atom">state</span>(<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>),<span class="hljs-name">S</span>,<span class="hljs-name">H</span>,<span class="hljs-name">H</span>) :-
  <span class="hljs-atom">nonlocal</span>(<span class="hljs-atom">counter</span>, <span class="hljs-atom">counter</span>, <span class="hljs-name">C</span>,<span class="hljs-name">S</span>),
  <span class="hljs-atom">num</span>(<span class="hljs-name">CN</span>),
  <span class="hljs-name">C</span> =:= <span class="hljs-name">CN</span> - <span class="hljs-number">1</span>,
  <span class="hljs-atom">nonlocal</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">Next</span>,<span class="hljs-name">_</span>), <span class="hljs-atom">value</span>, <span class="hljs-name">V</span>,<span class="hljs-name">S</span>),
  <span class="hljs-name">P</span> == <span class="hljs-name">V</span>.

<span class="hljs-comment">% [read] s1=1 &amp; !u1 &amp;  c=N-1 -&gt; (s1'=2) &amp; (u1'=false) &amp; (v1'=0);</span>
<span class="hljs-atom">trans</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">_N</span>,<span class="hljs-name">_Next</span>), <span class="hljs-atom">state</span>(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-name">_</span>,<span class="hljs-name">P</span>), <span class="hljs-atom">read</span>, <span class="hljs-atom">state</span>(<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-name">P</span>),<span class="hljs-name">S</span>,<span class="hljs-name">H</span>,<span class="hljs-name">H</span>) :-
  <span class="hljs-atom">nonlocal</span>(<span class="hljs-atom">counter</span>, <span class="hljs-atom">counter</span>, <span class="hljs-name">C</span>,<span class="hljs-name">S</span>),
  <span class="hljs-atom">num</span>(<span class="hljs-name">CN</span>),
  <span class="hljs-name">C</span> =:= <span class="hljs-name">CN</span> - <span class="hljs-number">1.</span>

<span class="hljs-comment">% done</span>
<span class="hljs-comment">% [done] s1=2 -&gt; (s1'=3) &amp; (u1'=false) &amp; (v1'=0) &amp; (p1'=0);</span>
<span class="hljs-atom">trans</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">_N</span>,<span class="hljs-name">_Next</span>), <span class="hljs-atom">state</span>(<span class="hljs-number">2</span>,<span class="hljs-name">_</span>,<span class="hljs-name">_</span>,<span class="hljs-name">_</span>), <span class="hljs-atom">done</span>, <span class="hljs-atom">state</span>(<span class="hljs-number">3</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>),<span class="hljs-name">_S</span>,<span class="hljs-name">H</span>,<span class="hljs-name">H</span>).

<span class="hljs-comment">% retry</span>
<span class="hljs-comment">% [retry] s1=2 -&gt; (s1'=0) &amp; (u1'=false) &amp; (v1'=0) &amp; (p1'=0);</span>
<span class="hljs-atom">trans</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">_N</span>,<span class="hljs-name">_Next</span>), <span class="hljs-atom">state</span>(<span class="hljs-number">2</span>,<span class="hljs-name">_</span>,<span class="hljs-name">_</span>,<span class="hljs-name">_</span>), <span class="hljs-atom">retry</span>, <span class="hljs-atom">state</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>),<span class="hljs-name">_S</span>,<span class="hljs-name">H</span>,<span class="hljs-name">H</span>).

<span class="hljs-comment">% loop (when finished to avoid deadlocks)</span>
<span class="hljs-comment">% [loop] s1=3 -&gt; (s1'=3);</span>
<span class="hljs-atom">trans</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">_N</span>,<span class="hljs-name">_Next</span>), <span class="hljs-atom">state</span>(<span class="hljs-number">3</span>,<span class="hljs-name">U</span>,<span class="hljs-name">V</span>,<span class="hljs-name">P</span>), <span class="hljs-atom">loop</span>, <span class="hljs-atom">state</span>(<span class="hljs-number">3</span>,<span class="hljs-name">U</span>,<span class="hljs-name">V</span>,<span class="hljs-name">P</span>),<span class="hljs-name">_S</span>,<span class="hljs-name">H</span>,<span class="hljs-name">H</span>).

<span class="hljs-atom">pick</span>(<span class="hljs-name">H</span>,<span class="hljs-name">V</span>):-
  <span class="hljs-atom">kr</span>(<span class="hljs-name">K</span>),
  <span class="hljs-name">K1</span> <span class="hljs-atom">is</span> <span class="hljs-name">K</span>-<span class="hljs-number">1</span>,
  <span class="hljs-name">PH</span> <span class="hljs-atom">is</span> <span class="hljs-number">1</span>/<span class="hljs-name">K</span>,
  <span class="hljs-atom">findall</span>(<span class="hljs-name">I</span>,<span class="hljs-atom">between</span>(<span class="hljs-number">0</span>,<span class="hljs-name">K1</span>,<span class="hljs-name">I</span>),<span class="hljs-name">L</span>),
  <span class="hljs-atom">foldl</span>(<span class="hljs-atom">pick_value</span>(<span class="hljs-name">H</span>,<span class="hljs-name">PH</span>),<span class="hljs-name">L</span>,(<span class="hljs-number">1</span>,<span class="hljs-name">_</span>),(<span class="hljs-name">_</span>,<span class="hljs-name">V</span>)).

<span class="hljs-atom">pick_value</span>(<span class="hljs-name">_H</span>,<span class="hljs-name">_PH</span>,<span class="hljs-name">_I</span>,(<span class="hljs-name">P0</span>,<span class="hljs-name">V0</span>),(<span class="hljs-name">P0</span>,<span class="hljs-name">V0</span>)):-
  <span class="hljs-atom">nonvar</span>(<span class="hljs-name">V0</span>).

<span class="hljs-atom">pick_value</span>(<span class="hljs-name">H</span>,<span class="hljs-name">PH</span>,<span class="hljs-name">I</span>,(<span class="hljs-name">P0</span>,<span class="hljs-name">V0</span>),(<span class="hljs-name">P1</span>,<span class="hljs-name">V1</span>)):-
  <span class="hljs-atom">var</span>(<span class="hljs-name">V0</span>),
  <span class="hljs-name">PF</span> <span class="hljs-atom">is</span> <span class="hljs-name">PH</span>/<span class="hljs-name">P0</span>,
  (<span class="hljs-atom">pick_fact</span>(<span class="hljs-name">H</span>,<span class="hljs-name">V0</span>,<span class="hljs-name">PF</span>)-&gt;
    <span class="hljs-name">P1</span>=<span class="hljs-name">PF</span>,
    <span class="hljs-name">V1</span>=<span class="hljs-name">I</span>
  ;
    <span class="hljs-name">P1</span> <span class="hljs-atom">is</span> <span class="hljs-name">P0</span>*(<span class="hljs-number">1</span>-<span class="hljs-name">PF</span>),
    <span class="hljs-name">V1</span>=<span class="hljs-name">V0</span>
  ).

<span class="hljs-atom">pick_fact</span>(<span class="hljs-name">_</span>,<span class="hljs-name">_</span>,<span class="hljs-name">P</span>):<span class="hljs-name">P</span>.

<span class="hljs-comment">%pick(H,0):0.5; pick(H,1):0.5.</span>

<span class="hljs-atom">ctrans</span>(<span class="hljs-name">S</span>, <span class="hljs-name">A</span>, <span class="hljs-name">T</span>, <span class="hljs-name">Hi</span>, <span class="hljs-name">Ho</span>) :-
    <span class="hljs-atom">config</span>(<span class="hljs-name">P</span>),
    <span class="hljs-atom">find_matching_trans</span>(<span class="hljs-name">P</span>,<span class="hljs-name">S</span>,<span class="hljs-name">S</span>,[],<span class="hljs-name">A</span>,<span class="hljs-name">T</span>,<span class="hljs-name">Hi</span>,<span class="hljs-name">Ho</span>).

<span class="hljs-atom">find_matching_trans</span>([], [], <span class="hljs-name">_CS</span>, <span class="hljs-name">_PA</span>, <span class="hljs-name">A</span>, [], <span class="hljs-name">H</span>,<span class="hljs-name">H</span>) :- <span class="hljs-atom">nonvar</span>(<span class="hljs-name">A</span>).
<span class="hljs-atom">find_matching_trans</span>([<span class="hljs-name">P</span>|<span class="hljs-name">Ps</span>], [<span class="hljs-name">S</span>|<span class="hljs-name">Ss</span>], <span class="hljs-name">CS</span>, <span class="hljs-name">PA</span>, <span class="hljs-name">A</span>, [<span class="hljs-name">T</span>|<span class="hljs-name">Ts</span>],<span class="hljs-name">Hi</span>,<span class="hljs-name">Ho</span>) :-
    <span class="hljs-atom">pick_trans</span>(<span class="hljs-name">P</span>, <span class="hljs-name">S</span>, <span class="hljs-name">CS</span>, <span class="hljs-name">PA</span>, <span class="hljs-name">A</span>, <span class="hljs-name">T</span>, <span class="hljs-name">Hi</span>,<span class="hljs-name">H1</span>),
    <span class="hljs-atom">find_matching_trans</span>(<span class="hljs-name">Ps</span>, <span class="hljs-name">Ss</span>, <span class="hljs-name">CS</span>, <span class="hljs-name">PA</span>, <span class="hljs-name">A</span>, <span class="hljs-name">Ts</span>,<span class="hljs-name">H1</span>,<span class="hljs-name">Ho</span>).
<span class="hljs-atom">find_matching_trans</span>([<span class="hljs-name">P</span>|<span class="hljs-name">Ps</span>], [<span class="hljs-name">S</span>|<span class="hljs-name">Ss</span>], <span class="hljs-name">CS</span>, <span class="hljs-name">PA</span>, <span class="hljs-name">A</span>, [<span class="hljs-name">S</span>|<span class="hljs-name">Ts</span>], <span class="hljs-name">Hi</span>,<span class="hljs-name">Ho</span>) :-
    <span class="hljs-comment">% skip current process; but then all transitions enabled in the current</span>
    <span class="hljs-comment">% process will be prohibited for selection in later processes.</span>
    <span class="hljs-atom">enabled_trans</span>(<span class="hljs-name">P</span>,<span class="hljs-name">L</span>),
    (<span class="hljs-atom">nonvar</span>(<span class="hljs-name">A</span>) -&gt; \+ <span class="hljs-atom">member</span>(<span class="hljs-name">A</span>,<span class="hljs-name">L</span>); <span class="hljs-atom">true</span>),
    <span class="hljs-atom">append</span>(<span class="hljs-name">L</span>, <span class="hljs-name">PA</span>, <span class="hljs-name">PA1</span>),
    <span class="hljs-atom">find_matching_trans</span>(<span class="hljs-name">Ps</span>, <span class="hljs-name">Ss</span>, <span class="hljs-name">CS</span>, <span class="hljs-name">PA1</span>, <span class="hljs-name">A</span>, <span class="hljs-name">Ts</span>, <span class="hljs-name">Hi</span>, <span class="hljs-name">Ho</span>).

<span class="hljs-atom">pick_trans</span>(<span class="hljs-name">P</span>, <span class="hljs-name">S</span>, <span class="hljs-name">CS</span>, <span class="hljs-name">PA</span>, <span class="hljs-name">A</span>, <span class="hljs-name">T</span>, <span class="hljs-name">H0</span>,<span class="hljs-name">H</span>) :-
    <span class="hljs-atom">etrans</span>(<span class="hljs-name">P</span>, <span class="hljs-name">S</span>, <span class="hljs-name">PA</span>, <span class="hljs-name">A</span>, <span class="hljs-name">T</span>,<span class="hljs-name">CS</span>, <span class="hljs-name">H0</span>,<span class="hljs-name">H</span>).

<span class="hljs-atom">etrans</span>(<span class="hljs-name">P</span>, <span class="hljs-name">S</span>, <span class="hljs-name">PA</span>, <span class="hljs-name">A</span>, <span class="hljs-name">T</span>, <span class="hljs-name">CS</span>,<span class="hljs-name">H0</span>,<span class="hljs-name">H</span>) :-
    <span class="hljs-atom">trans</span>(<span class="hljs-name">P</span>, <span class="hljs-name">S</span>, <span class="hljs-name">A</span>, <span class="hljs-name">T</span>,<span class="hljs-name">CS</span>,<span class="hljs-name">H0</span>,<span class="hljs-name">H</span>),
    <span class="hljs-name">A</span> \= <span class="hljs-atom">epsilon</span>,
    \+ <span class="hljs-atom">member</span>(<span class="hljs-name">A</span>, <span class="hljs-name">PA</span>).

<span class="hljs-atom">enabled_trans</span>(<span class="hljs-name">P</span>, <span class="hljs-name">L</span>) :-
    <span class="hljs-atom">setof</span>(<span class="hljs-name">A</span>, <span class="hljs-atom">enabled_trans_in_process</span>(<span class="hljs-name">P</span>,<span class="hljs-name">A</span>), <span class="hljs-name">L</span>).

<span class="hljs-atom">enabled_trans_in_process</span>(<span class="hljs-name">P</span>,<span class="hljs-name">A</span>) :-
    <span class="hljs-atom">clause</span>(<span class="hljs-atom">trans</span>(<span class="hljs-name">P</span>,<span class="hljs-name">_</span>,<span class="hljs-name">A</span>,<span class="hljs-name">_</span>,<span class="hljs-name">_</span>,<span class="hljs-name">_</span>,<span class="hljs-name">_</span>),<span class="hljs-name">_</span>),
    <span class="hljs-name">A</span> \= <span class="hljs-atom">epsilon</span>.

<span class="hljs-atom">nonlocal</span>(<span class="hljs-name">Proc</span>, <span class="hljs-name">Var</span>, <span class="hljs-name">Val</span>,<span class="hljs-name">CS</span>) :-
    <span class="hljs-atom">getpid</span>(<span class="hljs-name">Proc</span>, <span class="hljs-name">Var</span>, <span class="hljs-name">Pid</span>, <span class="hljs-name">Idx</span>),
    <span class="hljs-atom">nth1</span>(<span class="hljs-name">Pid</span>, <span class="hljs-name">CS</span>, <span class="hljs-name">State</span>),
    <span class="hljs-atom">arg</span>(<span class="hljs-name">Idx</span>, <span class="hljs-name">State</span>, <span class="hljs-name">Val</span>).
<span class="hljs-comment">%   writeln(nonlocal_read(Proc, State, Var, Val)).</span>

<span class="hljs-atom">getpid</span>(<span class="hljs-name">Proc</span>, <span class="hljs-name">Var</span>, <span class="hljs-name">Pid</span>, <span class="hljs-name">Idx</span>) :-
    <span class="hljs-atom">config</span>(<span class="hljs-name">Config</span>),
    <span class="hljs-atom">nth1</span>(<span class="hljs-name">Pid</span>, <span class="hljs-name">Config</span>, <span class="hljs-name">Proc</span>),
    <span class="hljs-atom">nonlocal_access</span>(<span class="hljs-name">Proc</span>, <span class="hljs-name">Var</span>, <span class="hljs-name">Idx</span>).

<span class="hljs-atom">get_processid</span>(<span class="hljs-name">P</span>):-
  <span class="hljs-atom">num</span>(<span class="hljs-name">N</span>),
  <span class="hljs-atom">between</span>(<span class="hljs-number">1</span>,<span class="hljs-name">N</span>,<span class="hljs-name">P</span>).

<span class="hljs-atom">config</span>([<span class="hljs-atom">counter</span>| <span class="hljs-name">L</span>]) :-
    <span class="hljs-atom">findall</span>(<span class="hljs-name">P</span>,<span class="hljs-atom">get_processid</span>(<span class="hljs-name">P</span>),<span class="hljs-name">PL</span>),
    <span class="hljs-atom">maplist</span>(<span class="hljs-atom">neighbor</span>,<span class="hljs-name">PL</span>,<span class="hljs-name">L</span>).

<span class="hljs-atom">neighbor</span>(<span class="hljs-name">I</span>,<span class="hljs-atom">process</span>(<span class="hljs-name">I</span>,<span class="hljs-name">J</span>)) :-
    <span class="hljs-atom">num</span>(<span class="hljs-name">N</span>),
    (<span class="hljs-name">I</span>&lt;<span class="hljs-name">N</span>
  -&gt;
      <span class="hljs-name">J</span> <span class="hljs-atom">is</span> <span class="hljs-name">I</span>+<span class="hljs-number">1</span>
    ;   <span class="hljs-name">J</span> = <span class="hljs-number">1</span>
    ).

<span class="hljs-comment">%config([counter, process(1,2), process(2,3), process(3,4), process(4,1)]).</span>

<span class="hljs-atom">init</span>(<span class="hljs-name">S</span>) :-
    <span class="hljs-atom">config</span>(<span class="hljs-name">P</span>),
    <span class="hljs-atom">maplist</span>(<span class="hljs-atom">init_state</span>,<span class="hljs-name">P</span>,<span class="hljs-name">S</span>).

<span class="hljs-atom">init_state</span>(<span class="hljs-atom">counter</span>, <span class="hljs-atom">counter</span>(<span class="hljs-number">1</span>)).
<span class="hljs-atom">init_state</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">_</span>,<span class="hljs-name">_</span>), <span class="hljs-atom">state</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)).

<span class="hljs-atom">nonlocal_access</span>(<span class="hljs-atom">counter</span>, <span class="hljs-atom">counter</span>, <span class="hljs-number">1</span>).
<span class="hljs-atom">nonlocal_access</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">_</span>,<span class="hljs-name">_</span>), <span class="hljs-atom">state</span>, <span class="hljs-number">1</span>).
<span class="hljs-atom">nonlocal_access</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">_</span>,<span class="hljs-name">_</span>), <span class="hljs-atom">uniqueid</span>, <span class="hljs-number">2</span>).
<span class="hljs-atom">nonlocal_access</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">_</span>,<span class="hljs-name">_</span>), <span class="hljs-atom">value</span>, <span class="hljs-number">3</span>).

<span class="hljs-atom">nl</span>(<span class="hljs-name">S</span>,<span class="hljs-name">P</span>):-
  <span class="hljs-atom">nonlocal</span>(<span class="hljs-atom">process</span>(<span class="hljs-name">P</span>, <span class="hljs-name">_</span>), <span class="hljs-atom">uniqueid</span>, <span class="hljs-number">0</span>,<span class="hljs-name">S</span>).

<span class="hljs-atom">num</span>(<span class="hljs-number">4</span>).
<span class="hljs-atom">kr</span>(<span class="hljs-number">4</span>).


:- <span class="hljs-atom">end_lpad</span>.

<span class="hljs-atom">graph_prob</span>(<span class="hljs-name">G</span>):-
  <span class="hljs-atom">retract</span>(<span class="hljs-atom">num</span>(<span class="hljs-name">N</span>)),
  <span class="hljs-atom">retract</span>(<span class="hljs-atom">kr</span>(<span class="hljs-name">K</span>)),
  <span class="hljs-atom">assert</span>(<span class="hljs-atom">num</span>(<span class="hljs-number">4</span>)),
  <span class="hljs-atom">assert</span>(<span class="hljs-atom">kr</span>(<span class="hljs-number">2</span>)),
  <span class="hljs-atom">findall</span>(<span class="hljs-name">L</span>-<span class="hljs-name">P</span>,
    (<span class="hljs-atom">between</span>(<span class="hljs-number">1</span>,<span class="hljs-number">6</span>,<span class="hljs-name">L</span>),<span class="hljs-atom">mc_sample</span>(<span class="hljs-atom">bounded_eventually</span>(<span class="hljs-atom">elect</span>,<span class="hljs-name">L</span>),<span class="hljs-number">100</span>,<span class="hljs-name">P</span>)),<span class="hljs-name">LV</span>),
  <span class="hljs-name">G</span>=<span class="hljs-atom">c3</span>{<span class="hljs-atom">data</span>:<span class="hljs-name">_</span>{<span class="hljs-atom">x</span>:<span class="hljs-atom">x</span>, <span class="hljs-atom">rows</span>:[<span class="hljs-atom">x</span>-<span class="hljs-string">'Probability of leader elected within L rounds (N=4, K=2)'</span>|<span class="hljs-name">LV</span>]},<span class="hljs-comment">%legend:_{show: false},</span>
    <span class="hljs-atom">axis</span>:<span class="hljs-name">_</span>{<span class="hljs-atom">x</span>:<span class="hljs-name">_</span>{<span class="hljs-atom">min</span>:<span class="hljs-number">1</span>,<span class="hljs-atom">max</span>:<span class="hljs-number">6</span>,<span class="hljs-atom">label</span>:<span class="hljs-string">'L'</span>,<span class="hljs-atom">padding</span>:<span class="hljs-name">_</span>{<span class="hljs-atom">bottom</span>:<span class="hljs-number">0.0</span>,<span class="hljs-atom">top</span>:<span class="hljs-number">0.0</span>}},
           <span class="hljs-atom">y</span>:<span class="hljs-name">_</span>{<span class="hljs-atom">label</span>:<span class="hljs-string">'Probability'</span>,<span class="hljs-atom">padding</span>:<span class="hljs-name">_</span>{<span class="hljs-atom">bottom</span>:<span class="hljs-number">0.0</span>,<span class="hljs-atom">top</span>:<span class="hljs-number">0.0</span>}}}},
  <span class="hljs-atom">retract</span>(<span class="hljs-atom">num</span>(<span class="hljs-number">4</span>)),
  <span class="hljs-atom">retract</span>(<span class="hljs-atom">kr</span>(<span class="hljs-number">2</span>)),
  <span class="hljs-atom">assert</span>(<span class="hljs-atom">num</span>(<span class="hljs-name">N</span>)),
  <span class="hljs-atom">assert</span>(<span class="hljs-atom">kr</span>(<span class="hljs-name">K</span>)).

<span class="hljs-atom">graph_exp_rounds_n</span>(<span class="hljs-name">G</span>):-
  <span class="hljs-atom">retract</span>(<span class="hljs-atom">num</span>(<span class="hljs-name">NI</span>)),
  <span class="hljs-atom">retract</span>(<span class="hljs-atom">kr</span>(<span class="hljs-name">KI</span>)),
  <span class="hljs-atom">assert</span>(<span class="hljs-atom">kr</span>(<span class="hljs-number">3</span>)),
  <span class="hljs-atom">findall</span>(<span class="hljs-name">N</span>-<span class="hljs-name">E</span>,
    (<span class="hljs-atom">between</span>(<span class="hljs-number">3</span>,<span class="hljs-number">8</span>,<span class="hljs-name">N</span>),
     <span class="hljs-atom">assert</span>(<span class="hljs-atom">num</span>(<span class="hljs-name">N</span>)),
     <span class="hljs-atom">mc_expectation</span>(<span class="hljs-atom">eventually</span>(<span class="hljs-atom">elect</span>,<span class="hljs-name">T</span>),<span class="hljs-number">100</span>,<span class="hljs-name">T</span>,<span class="hljs-name">E</span>),
     <span class="hljs-atom">retract</span>(<span class="hljs-atom">num</span>(<span class="hljs-name">N</span>))),
    <span class="hljs-name">LV</span>),
  <span class="hljs-name">G</span>=<span class="hljs-atom">c3</span>{<span class="hljs-atom">data</span>:<span class="hljs-name">_</span>{<span class="hljs-atom">x</span>:<span class="hljs-atom">x</span>, <span class="hljs-atom">rows</span>:[<span class="hljs-atom">x</span>-<span class="hljs-string">'Expected rounds to elect a leader (K=3)'</span>|<span class="hljs-name">LV</span>]},<span class="hljs-comment">%legend:_{show: false},</span>
    <span class="hljs-atom">axis</span>:<span class="hljs-name">_</span>{<span class="hljs-atom">x</span>:<span class="hljs-name">_</span>{<span class="hljs-atom">min</span>:<span class="hljs-number">3</span>,<span class="hljs-atom">max</span>:<span class="hljs-number">8</span>,<span class="hljs-atom">label</span>:<span class="hljs-string">'N'</span>,<span class="hljs-atom">padding</span>:<span class="hljs-name">_</span>{<span class="hljs-atom">bottom</span>:<span class="hljs-number">0.0</span>,<span class="hljs-atom">top</span>:<span class="hljs-number">0.0</span>}},
           <span class="hljs-atom">y</span>:<span class="hljs-name">_</span>{<span class="hljs-atom">label</span>:<span class="hljs-string">'Expected rounds'</span>,<span class="hljs-atom">padding</span>:<span class="hljs-name">_</span>{<span class="hljs-atom">bottom</span>:<span class="hljs-number">0.0</span>,<span class="hljs-atom">top</span>:<span class="hljs-number">0.0</span>}}}},
  <span class="hljs-atom">retract</span>(<span class="hljs-atom">kr</span>(<span class="hljs-number">3</span>)),
  <span class="hljs-atom">assert</span>(<span class="hljs-atom">num</span>(<span class="hljs-name">NI</span>)),
  <span class="hljs-atom">assert</span>(<span class="hljs-atom">kr</span>(<span class="hljs-name">KI</span>)).

<span class="hljs-atom">graph_exp_rounds_k</span>(<span class="hljs-name">G</span>):-
  <span class="hljs-atom">retract</span>(<span class="hljs-atom">num</span>(<span class="hljs-name">NI</span>)),
  <span class="hljs-atom">retract</span>(<span class="hljs-atom">kr</span>(<span class="hljs-name">KI</span>)),
  <span class="hljs-atom">assert</span>(<span class="hljs-atom">num</span>(<span class="hljs-number">3</span>)),
  <span class="hljs-atom">findall</span>(<span class="hljs-name">K</span>-<span class="hljs-name">E</span>,
    (<span class="hljs-atom">between</span>(<span class="hljs-number">3</span>,<span class="hljs-number">8</span>,<span class="hljs-name">K</span>),
     <span class="hljs-atom">assert</span>(<span class="hljs-atom">kr</span>(<span class="hljs-name">K</span>)),
     <span class="hljs-atom">mc_expectation</span>(<span class="hljs-atom">eventually</span>(<span class="hljs-atom">elect</span>,<span class="hljs-name">T</span>),<span class="hljs-number">500</span>,<span class="hljs-name">T</span>,<span class="hljs-name">E</span>),
     <span class="hljs-atom">retract</span>(<span class="hljs-atom">kr</span>(<span class="hljs-name">K</span>))),
    <span class="hljs-name">LV</span>),
  <span class="hljs-name">G</span>=<span class="hljs-atom">c3</span>{<span class="hljs-atom">data</span>:<span class="hljs-name">_</span>{<span class="hljs-atom">x</span>:<span class="hljs-atom">x</span>, <span class="hljs-atom">rows</span>:[<span class="hljs-atom">x</span>-<span class="hljs-string">'Expected rounds to elect a leader (N=3)'</span>|<span class="hljs-name">LV</span>]},<span class="hljs-comment">%legend:_{show: false},</span>
    <span class="hljs-atom">axis</span>:<span class="hljs-name">_</span>{<span class="hljs-atom">x</span>:<span class="hljs-name">_</span>{<span class="hljs-atom">min</span>:<span class="hljs-number">3</span>,<span class="hljs-atom">max</span>:<span class="hljs-number">8</span>,<span class="hljs-atom">label</span>:<span class="hljs-string">'K'</span>,<span class="hljs-atom">padding</span>:<span class="hljs-name">_</span>{<span class="hljs-atom">bottom</span>:<span class="hljs-number">0.0</span>,<span class="hljs-atom">top</span>:<span class="hljs-number">0.0</span>}},
           <span class="hljs-atom">y</span>:<span class="hljs-name">_</span>{<span class="hljs-atom">label</span>:<span class="hljs-string">'Expected rounds'</span>,<span class="hljs-atom">padding</span>:<span class="hljs-name">_</span>{<span class="hljs-atom">bottom</span>:<span class="hljs-number">0.0</span>,<span class="hljs-atom">top</span>:<span class="hljs-number">0.0</span>}}}},
  <span class="hljs-atom">retract</span>(<span class="hljs-atom">num</span>(<span class="hljs-number">3</span>)),
  <span class="hljs-atom">assert</span>(<span class="hljs-atom">num</span>(<span class="hljs-name">NI</span>)),
  <span class="hljs-atom">assert</span>(<span class="hljs-atom">kr</span>(<span class="hljs-name">KI</span>)).
</code></pre></div>
                    <p>We first consider the problem of computing expectations.
                        We would like to compute the expected number of rounds to elect a leader.</p>
                    <p>We can compute expectations with</p>
                    <pre><code class="language-{.pl}">mc_expectation(:<span class="hljs-string">Query:</span>atom,+<span class="hljs-string">N:</span><span class="hljs-typename">int</span>,?Arg:var,-<span class="hljs-string">Exp:</span><span class="hljs-typename">float</span>).
</code></pre>
                    <p>that computes the expected value of <code>Arg</code> in <code>Query</code> by
                        sampling.
                        It takes <code>N</code> samples of <code>Query</code> and sums up the value of <code>Arg</code> for
                        each sample. The overall sum is divided by <code>N</code> to give <code>Exp</code>.</p>
                    <p>An example of use of the above predicate is</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">mc_expectation</span><span class="hljs-params">(eventually(elect,T)</span></span>,<span class="hljs-number">1000</span>,T,E).
</code></pre></div>
                    <p>that returns in E the expected value of rounds necessary to elect a leader computed by taking 1000 samples.</p>
                    <p>We can mix LPADs and Prolog for drawing a graph of the expected number of
                        rounds to elect a leader as a
                        funtion of the number of processes when K=3. We use the Prolog code below,
                        that is included in the program above outside <code>:-begin/end_lpad</code>:</p>
                    <pre><code class="language-{.pl}">graph_exp_rounds_n(G):-
  retract(num(NI)),
  retract(kr(KI)),
  <span class="hljs-keyword">assert</span>(kr(<span class="hljs-number">3</span>)),
  findall(N-E,
    (between(<span class="hljs-number">3</span>,<span class="hljs-number">8</span>,N),
     <span class="hljs-keyword">assert</span>(num(N)),
     mc_expectation(eventually(elect,T),<span class="hljs-number">100</span>,T,E),
     retract(num(N))),
    LV),
  G=c3{<span class="hljs-string">data:</span>_{<span class="hljs-string">x:</span>x, <span class="hljs-string">rows:</span>[x-<span class="hljs-string">'Expected rounds to elect a leader (K=3)'</span>|LV]},%<span class="hljs-string">legend:</span>_{<span class="hljs-string">show:</span> <span class="hljs-literal">false</span>},
<span class="hljs-label">    axis:</span>_{<span class="hljs-string">x:</span>_{<span class="hljs-string">min:</span><span class="hljs-number">3</span>,<span class="hljs-string">max:</span><span class="hljs-number">8</span>,<span class="hljs-string">label:</span><span class="hljs-string">'N'</span>,<span class="hljs-string">padding:</span>_{<span class="hljs-string">bottom:</span><span class="hljs-number">0.0</span>,<span class="hljs-string">top:</span><span class="hljs-number">0.0</span>}},
<span class="hljs-label">           y:</span>_{<span class="hljs-string">label:</span><span class="hljs-string">'Expected rounds'</span>,<span class="hljs-string">padding:</span>_{<span class="hljs-string">bottom:</span><span class="hljs-number">0.0</span>,<span class="hljs-string">top:</span><span class="hljs-number">0.0</span>}}}},
  retract(kr(<span class="hljs-number">3</span>)),
  <span class="hljs-keyword">assert</span>(num(NI)),
  <span class="hljs-keyword">assert</span>(kr(KI)).
</code></pre>
                    <p>Note that <code>num/1</code> and <code>kr/1</code> are declared as dynamic at the beginning of the
                        program, so their definition can be changed. <code>num/1</code> stores the number of
                        processes N and <code>kr/1</code> the value of K.
                        <code>graph_exp_rounds_n/1</code> returns a dict that is rendered as a <code>c3</code> graph.
                        The predicates performs a <code>findall/3</code> where it first asserts an increasing
                        value for N, from 3 to 8, and then computes the expected value of the rounds
                        necessary to elect a leader. The resulting data is then inserted in a <code>c3</code> dict.
                        Calling <code>graph_exp_rounds_n(G)</code> you get a graph of the expected number of rounds
                        to elect a leader as a funtion of the number of processes when K=3.</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">graph_exp_rounds_n</span><span class="hljs-params">(G)</span></span>.
</code></pre></div>
                    <hr>
                    <p>Complete example: <a target="_blank" href="http://cplint.lamping.unife.it/example/inference/pctl_slep.pl">pctl_slep.pl</a></p>
                    <hr>
                    <ul>
                        <li>References:
                            <ul>
                                <li>Gorlin, Andrey, C. R. Ramakrishnan, and Scott A. Smolka. <em>Model checking with probabilistic tabled logic programming</em>. Theory and Practice of Logic Programming 12.4-5 (2012).</li>
                                <li><a href="http://www.prismmodelchecker.org/casestudies/synchronous_leader.php">http://www.prismmodelchecker.org/casestudies/synchronous_leader.php</a></li>
                            </ul>
                        </li>
                    </ul>
                    <hr>
                    <p><a href="#index">Back to Index</a></p>

                </div>
                <hr/>
                <div id="arithm">
                    <h1><a id="Random_arithmetic_functions_0"></a>Random arithmetic functions</h1>
                    <p>In this example we want to show how to perform conditional inference in
                        an approximate way using sampling. In particular, we will show how to
                        use rejection sampling and Metropolis-Hastings.</p>
                    <p>This example generatively defines a random arithmetic function.
                        The problem is to predict the value returned by the function given one or
                        two couples of input-output, i.e., to compute a conditional probability.
                        This program is translated from the example
                        <a href="http://forestdb.org/models/arithmetic.html">http://forestdb.org/models/arithmetic.html</a> in the Church functional probabilistic programming language.
                        Sampling is necessary as queries have an infinite number of explanations.</p>
                    <h2><a id="Full_program_12"></a>Full program</h2>
                    <p>The full program of this example is</p>
                    <div class="nb-cell program prolog" data-singleline="true"><pre><code class="language-{.pl}"><span class="hljs-value">:- <span class="hljs-function">use_module</span>(<span class="hljs-function">library</span>(mcintyre)).

:- <span class="hljs-function">if</span>(<span class="hljs-function">current_predicate</span>(use_rendering/<span class="hljs-number">1</span>)).
:- <span class="hljs-function">use_rendering</span>(c3).
:- endif.

:- mc.

:- begin_lpad.

<span class="hljs-function">eval</span>(X,Y):-
  <span class="hljs-function">random_fn</span>(X,<span class="hljs-number">0</span>,F),
  Y is F.

<span class="hljs-function">op</span>(+):<span class="hljs-number">0.5</span>;</span><span class="hljs-function">op</span>(-)<span class="hljs-value">:<span class="hljs-number">0.5</span>.

<span class="hljs-function">random_fn</span>(X,L,F):-
  <span class="hljs-function">comb</span>(L),
  <span class="hljs-function">random_fn</span>(X,<span class="hljs-function">l</span>(L),F1),
  <span class="hljs-function">random_fn</span>(X,<span class="hljs-function">r</span>(L),F2),
  <span class="hljs-function">op</span>(Op),
  F=..[Op,F1,F2].

<span class="hljs-function">random_fn</span>(X,L,F):-
  \+ <span class="hljs-function">comb</span>(L),
  <span class="hljs-function">base_random_fn</span>(X,L,F).

<span class="hljs-function">comb</span>(_):<span class="hljs-number">0.3</span>.

<span class="hljs-function">base_random_fn</span>(X,L,X):-
  <span class="hljs-function">identity</span>(L).

<span class="hljs-function">base_random_fn</span>(_X,L,C):-
  \+ <span class="hljs-function">identity</span>(L),
  <span class="hljs-function">random_const</span>(L,C).

<span class="hljs-function">identity</span>(_):<span class="hljs-number">0.5</span>.

<span class="hljs-function">random_const</span>(L,<span class="hljs-number">0</span>):<span class="hljs-number">0.1</span>;</span><span class="hljs-function">random_const</span>(L,1)<span class="hljs-value">:<span class="hljs-number">0.1</span>;</span><span class="hljs-function">random_const</span>(L,2)<span class="hljs-value">:<span class="hljs-number">0.1</span>;</span>
<span class="hljs-function">random_const</span>(L,3)<span class="hljs-value">:<span class="hljs-number">0.1</span>;</span><span class="hljs-function">random_const</span>(L,4)<span class="hljs-value">:<span class="hljs-number">0.1</span>;</span><span class="hljs-function">random_const</span>(L,5)<span class="hljs-value">:<span class="hljs-number">0.1</span>;</span>
<span class="hljs-function">random_const</span>(L,6)<span class="hljs-value">:<span class="hljs-number">0.1</span>;</span><span class="hljs-function">random_const</span>(L,7)<span class="hljs-value">:<span class="hljs-number">0.1</span>;</span><span class="hljs-function">random_const</span>(L,8)<span class="hljs-value">:<span class="hljs-number">0.1</span>;</span>
<span class="hljs-function">random_const</span>(L,9)<span class="hljs-value">:<span class="hljs-number">0.1</span>.

:- end_lpad.
</span></code></pre></div>
                    <p>We know that the random function return 3 for input 1 and we want to
                        compute the probability that it returns 4 for input 2.
                        We thus need to ask a conditional query and sampling is necessary as queries have an infinite number of explanations.</p>
                    <p>The simplest approach is to use rejection sampling:  you first query the evidence and, if the query is successful, query the goal in the same sample, otherwise
                        the sample is discarded.</p>
                    <p>This can be done with</p>
                    <pre><code class="language-{.pl}">mc_rejection_sample(:<span class="hljs-string">Query:</span>atom,:<span class="hljs-string">Evidence:</span>atom,+<span class="hljs-string">Samples:</span><span class="hljs-typename">int</span>,
  -<span class="hljs-string">Successes:</span><span class="hljs-typename">int</span>,-<span class="hljs-string">Failures:</span><span class="hljs-typename">int</span>,-<span class="hljs-string">Probability:</span><span class="hljs-typename">float</span>).
</code></pre>
                    <p>that takes <code>Samples</code> samples of <code>Query</code> given that <code>Evidence</code> is true.</p>
                    <p>An example of use of the above predicate is</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">mc_rejection_sample</span><span class="hljs-params">(eval(<span class="hljs-number">2</span>,<span class="hljs-number">4</span>)</span></span>,<span class="hljs-function"><span class="hljs-title">eval</span><span class="hljs-params">(<span class="hljs-number">1</span>,<span class="hljs-number">3</span>)</span></span>,<span class="hljs-number">1000</span>,T,F,P).
</code></pre></div>
                    <p>that perform rejection sampling of <code>eval(2,4)</code> given that <code>eval(1,3)</code> is true.</p>
                    <p>Differently from exact inference, in approximate inference the evidence can be a conjunction of atoms, so if you also know that <code>eval(0,2)</code> is true, you can use</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">mc_rejection_sample</span><span class="hljs-params">(eval(<span class="hljs-number">2</span>,<span class="hljs-number">4</span>)</span></span>,(<span class="hljs-function"><span class="hljs-title">eval</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>)</span></span>,<span class="hljs-function"><span class="hljs-title">eval</span><span class="hljs-params">(<span class="hljs-number">1</span>,<span class="hljs-number">3</span>)</span></span>),<span class="hljs-number">1000</span>,T,F,P).
</code></pre></div>
                    <p>and, as you can see, the query with more evidence is now almost certainly true.</p>
                    <p>In Metropolis-Hastings MCMC, a Markov chain is produced using the algorithm
                        of [Nampally, Ramakrishnan, 2014]:
                        after a sample, a number of sampled probabilistic choices are deleted and the others are retained for the next sample.
                        The sample is accepted with a probability of min{1,N0/N1} where N0 is the number of choices sampled
                        in the previous sample and N1 is the number of choices sampled in the current sample. Metropolis-Hastings is usually much faster than rejection sampling
                        because less samples are discarded.</p>
                    <p>To use Metropolis-Hastings, the following predicate is available</p>
                    <pre><code class="language-{.pl}">mc_mh_sample(:<span class="hljs-string">Query:</span>atom,:<span class="hljs-string">Evidence:</span>atom,+<span class="hljs-string">Samples:</span><span class="hljs-typename">int</span>,+<span class="hljs-string">Lag:</span><span class="hljs-typename">int</span>,
  -<span class="hljs-string">Successes:</span><span class="hljs-typename">int</span>,-<span class="hljs-string">Failures:</span><span class="hljs-typename">int</span>,-<span class="hljs-string">Probability:</span><span class="hljs-typename">float</span>).
</code></pre>
                    <p>where <code>Lag</code> is the number of sampled choices to forget before taking a new sample.
                        For example

                    <div class="nb-cell query"><pre><code class="language-{.pl}">mc_mh_sample(eval(<span class="hljs-number">2</span>,<span class="hljs-number">4</span>),eval(<span class="hljs-number">1</span>,<span class="hljs-number">3</span>),<span class="hljs-number">10000</span>,<span class="hljs-number">1</span>,T,F,P).
</code></pre></div>
                    <p>takes 10000 accepted samples and returns in <code>T</code> the number of samples where
                        eval(2,4) is true, in <code>F</code> the number of samples where eval(2,4) is false and in <code>P</code> the
                        estimated probability (<code>T/10000</code>).</p>
                    <p>You can also compute conditional expectations with</p>
                    <pre><code class="language-{.pl}">mc_mh_expectation(:<span class="hljs-string">Query:</span>atom,:<span class="hljs-string">Evidence:</span>atom,+<span class="hljs-string">N:</span><span class="hljs-typename">int</span>,+<span class="hljs-string">Lag:</span><span class="hljs-typename">int</span>,?Arg:var,-<span class="hljs-string">Exp:</span><span class="hljs-typename">float</span>).
</code></pre>
                    <p>as in</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">mc_mh_expectation</span><span class="hljs-params">(eval(<span class="hljs-number">2</span>,Y)</span></span>,<span class="hljs-function"><span class="hljs-title">eval</span><span class="hljs-params">(<span class="hljs-number">1</span>,<span class="hljs-number">3</span>)</span></span>,<span class="hljs-number">1000</span>,<span class="hljs-number">1</span>,Y,E).
</code></pre></div>
                    <p>that computes the expectation of argument <code>Y</code> of <code>eval(2,Y)</code> given that
                        <code>eval(1,3)</code> is true by taking 1000 samples using Metropolis-Hastings MCMC.</p>
                    <hr>
                    <p>Complete example: <a target="_blank" href="http://cplint.lamping.unife.it/example/inference/arithm.pl">arithm.pl</a></p>
                    <hr>
                    <ul>
                        <li>References:
                            <ul>
                                <li>Nampally, Arun, and C. R. Ramakrishnan. <em>Adaptive MCMC-Based Inference in Probabilistic Logic Programs</em>. arXiv preprint arXiv:1403.6036 (2014).</li>
                                <li><a href="http://forestdb.org/models/arithmetic.html">http://forestdb.org/models/arithmetic.html</a></li>
                            </ul>
                        </li>
                    </ul>
                    <hr>
                    <p><a href="#index">Back to Index</a></p>

                </div>
                <hr/>
                <div id="mach">
                    <h1><a id="Machines_0"></a>Machines</h1>
                    <p>In this section we will see how to learn the parameters given a background knowledge and an initial program. We take into account the Machines dataset (see reference).</p>
                    <p><strong>Note</strong>: the learning algorithms are available only if you use the Prolog editor.</p>
                    <h2><a id="Writing_the_program_step_by_step_5"></a>Writing the program step by step</h2>
                    <p>To execute a learning algorithm the input source must be divided in five parts:</p>
                    <ul>
                        <li>preamble,</li>
                        <li>background knowledge, i.e., knowledge valid for all interpretations,</li>
                        <li>initial LPAD program for you which you want to learn the parameters (optional),</li>
                        <li>language bias information,</li>
                        <li>example interpretations.</li>
                    </ul>
                    <p>Here we will define a program step by step and then execute the algorithm <a target="_blank" href="http://cplint.lamping.unife.it/help/about.html#emblem">EMBLEM</a> which learns the parameters of a given initial LPAD program.</p>
                    <p>For more information of how to perform learning see the <a target="_blank" href="http://cplint.lamping.unife.it/help/help-cplint.html">manual</a> (<a target="_blank" href="https://github.com/friguzzi/cplint/blob/master/doc/help-cplint.pdf">PDF version</a>).</p>
                    <h3><a id="Preamble_17"></a>Preamble</h3>
                    <p>In order to perform either EMBLEM or SLIPCOVER you need to load the library <code>slipcover</code> with the command</p>
                    <pre><code class="language-{.pl}">:- <span class="hljs-function"><span class="hljs-title">use_module</span><span class="hljs-params">(library(slipcover)</span></span>).
</code></pre>
                    <p>After that you have to initialize <code>slipcover</code> with the command</p>
                    <pre><code class="language-{.pl}">:- <span class="hljs-atom">sc</span>.
</code></pre>
                    <p>At this point you can start setting parameters for SLIPCOVER with the predicate <code>set_sc/2</code>. For the complete list of the available parameters and their meanings see the <a target="_blank" href="http://cplint.lamping.unife.it/help/help-cplint.html">manual</a>. In our example we will set the following parameters</p>
                    <pre><code class="language-{.pl}">:- <span class="hljs-function"><span class="hljs-title">set_sc</span><span class="hljs-params">(depth_bound,false)</span></span>.
:- <span class="hljs-function"><span class="hljs-title">set_sc</span><span class="hljs-params">(neg_ex,given)</span></span>.
:- <span class="hljs-function"><span class="hljs-title">set_sc</span><span class="hljs-params">(megaex_bottom,<span class="hljs-number">15</span>)</span></span>.
:- <span class="hljs-function"><span class="hljs-title">set_sc</span><span class="hljs-params">(max_iter,<span class="hljs-number">10</span>)</span></span>.
:- <span class="hljs-function"><span class="hljs-title">set_sc</span><span class="hljs-params">(max_iter_structure,<span class="hljs-number">50</span>)</span></span>.
:- <span class="hljs-function"><span class="hljs-title">set_sc</span><span class="hljs-params">(verbosity,<span class="hljs-number">1</span>)</span></span>.
</code></pre>
                    <h3><a id="Background_knowledge_36"></a>Background knowledge</h3>
                    <p>We have defined the preamble, now we can specify the background knowledge with a fact of the form</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">bg</span><span class="hljs-params">(&lt;list of terms representing clauses&gt;)</span></span>.
</code></pre>
                    <p>Alternatively, we can specify a set of clauses by including them in a section between the goals <code>:- begin_bg.</code> and <code>:- end_bg.</code>. We will use the latter approach.</p>
                    <pre><code class="language-{.pl}">:- begin_bg.
<span class="hljs-function"><span class="hljs-title">component</span><span class="hljs-params">(C)</span></span>:-
  <span class="hljs-function"><span class="hljs-title">replaceable</span><span class="hljs-params">(C)</span></span>.
<span class="hljs-function"><span class="hljs-title">component</span><span class="hljs-params">(C)</span></span>:-
  <span class="hljs-function"><span class="hljs-title">not_replaceable</span><span class="hljs-params">(C)</span></span>.
<span class="hljs-function"><span class="hljs-title">replaceable</span><span class="hljs-params">(gear)</span></span>.
<span class="hljs-function"><span class="hljs-title">replaceable</span><span class="hljs-params">(wheel)</span></span>.
<span class="hljs-function"><span class="hljs-title">replaceable</span><span class="hljs-params">(chain)</span></span>.
<span class="hljs-function"><span class="hljs-title">not_replaceable</span><span class="hljs-params">(engine)</span></span>.
<span class="hljs-function"><span class="hljs-title">not_replaceable</span><span class="hljs-params">(control_unit)</span></span>.
<span class="hljs-function"><span class="hljs-title">not_worn</span><span class="hljs-params">(C)</span></span>:-
  <span class="hljs-function"><span class="hljs-title">component</span><span class="hljs-params">(C)</span></span>,
  \+ <span class="hljs-function"><span class="hljs-title">worn</span><span class="hljs-params">(C)</span></span>.
one_worn:-
  <span class="hljs-function"><span class="hljs-title">worn</span><span class="hljs-params">(_)</span></span>.
none_worn:-
  \+ one_worn.
:- end_bg.
</code></pre>
                    <h3><a id="Initial_program_63"></a>Initial program</h3>
                    <p>At this point we can define an initial program for which you want to learn the parameters. We can do it with a fact of the form</p>
                    <pre><code class="language-{.pl}"><span class="hljs-keyword">in</span>(&lt;<span class="hljs-type">list</span> <span class="hljs-keyword">of</span> terms representing clauses&gt;).
</code></pre>
                    <p>Alternatively, you can specify an input program in a section between <code>:- begin_in.</code> and <code>:- end_in.</code>. We will use the latter method. Therefore in our example</p>
                    <pre><code class="language-{.pl}">:- begin_in.
<span class="hljs-function"><span class="hljs-title">class</span><span class="hljs-params">(sendback)</span></span>:<span class="hljs-number">0.5</span> :-
  <span class="hljs-function"><span class="hljs-title">worn</span><span class="hljs-params">(A)</span></span>,
  <span class="hljs-function"><span class="hljs-title">not_replaceable</span><span class="hljs-params">(A)</span></span>.

<span class="hljs-function"><span class="hljs-title">class</span><span class="hljs-params">(fix)</span></span>:<span class="hljs-number">0.6</span> :-
  <span class="hljs-function"><span class="hljs-title">worn</span><span class="hljs-params">(A)</span></span>,
  <span class="hljs-function"><span class="hljs-title">replaceable</span><span class="hljs-params">(A)</span></span>.

<span class="hljs-function"><span class="hljs-title">class</span><span class="hljs-params">(ok)</span></span>:<span class="hljs-number">0.5</span> :-
  <span class="hljs-function"><span class="hljs-title">not_worn</span><span class="hljs-params">(_A)</span></span>.
:- end_in.
</code></pre>
                    <h3><a id="Language_Bias_84"></a>Language Bias</h3>
                    <p>The language bias part contains the declarations of the input and output predicates.</p>
                    <p>The typical input for EMBLEM will be a set of interpretations, i.e. sets of grounds facts. Among the predicates for the input facts the use has to indicate which are the output predicates. Output predicates are declared as</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">output</span><span class="hljs-params">(&lt;predicate&gt;/&lt;arity&gt;)</span></span>.
</code></pre>
                    <p>In our example</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">output</span><span class="hljs-params">(class/<span class="hljs-number">1</span>)</span></span>.
</code></pre>
                    <p>Input predicates are those whose atoms you are not interested in predicting.</p>
                    <p>You can declare <strong>closed world input predicates</strong> with</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">input_cw</span><span class="hljs-params">(&lt;predicate&gt;/&lt;arity&gt;)</span></span>.
</code></pre>
                    <p>For these predicates, the only true atoms are those in the interpretations and those derivable from them using the background knowledge, the clauses in the
                        input/hypothesized program are not used to derive atoms for these predicates.
                        Moreover, clauses of the background knowledge that define closed world input predicates and that call an output predicate in the body will not be used for deriving examples.
                        In our example</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">input_cw</span><span class="hljs-params">(replaceable/<span class="hljs-number">1</span>)</span></span>.
<span class="hljs-function"><span class="hljs-title">input_cw</span><span class="hljs-params">(not_replaceable/<span class="hljs-number">1</span>)</span></span>.
<span class="hljs-function"><span class="hljs-title">input_cw</span><span class="hljs-params">(worn/<span class="hljs-number">1</span>)</span></span>.
<span class="hljs-function"><span class="hljs-title">input_cw</span><span class="hljs-params">(not_worn/<span class="hljs-number">1</span>)</span></span>.
<span class="hljs-function"><span class="hljs-title">input_cw</span><span class="hljs-params">(none_worn/<span class="hljs-number">0</span>)</span></span>.
</code></pre>
                    <p>Besides closed world input predicate we can declare
                        <strong>open world input predicates</strong> with</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">input</span><span class="hljs-params">(&lt;predicate&gt;/&lt;arity&gt;)</span></span>.
</code></pre>
                    <p>In our example we do not have open world input predicates.</p>
                    <h3><a id="Example_interpretations_121"></a>Example interpretations</h3>
                    <p>The last part of the file contains the data. You can specify data with two modalities: models and keys.</p>
                    <p>In the models type, you specify an example model (or interpretation) as a list of Prolog facts initiated by <code>begin(model(&lt;name&gt;)).</code> and terminated by <code>end(model(&lt;name&gt;)).</code>.</p>
                    <p>Alternatively, with the keys modality, you can directly write the facts and the first argument will be interpreted as a model identifier.</p>
                    <p>The two modalities, models and keys, can be mixed in the same source.</p>
                    <p>If we use the model modality for the example/interpretation 1</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">begin</span><span class="hljs-params">(model(<span class="hljs-number">1</span>)</span></span>).
<span class="hljs-function"><span class="hljs-title">class</span><span class="hljs-params">(sendback)</span></span>.
<span class="hljs-function"><span class="hljs-title">neg</span><span class="hljs-params">(class(fix)</span></span>).
<span class="hljs-function"><span class="hljs-title">neg</span><span class="hljs-params">(class(ok)</span></span>).
<span class="hljs-function"><span class="hljs-title">worn</span><span class="hljs-params">(gear)</span></span>.
<span class="hljs-function"><span class="hljs-title">worn</span><span class="hljs-params">(engine)</span></span>.
<span class="hljs-function"><span class="hljs-title">end</span><span class="hljs-params">(model(<span class="hljs-number">1</span>)</span></span>).
</code></pre>
                    <p>If we use this modality the system asserts a <code>int(&lt;name&gt;).</code> for each model enclosed in <code>begin(model(&lt;name&gt;)).</code> and <code>end(model(&lt;name&gt;)).</code>.</p>
                    <p>Instead, if we use the key modality, our example will be (note the first argument of each fact)</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">class</span><span class="hljs-params">(<span class="hljs-number">1</span>,sendback)</span></span>.
<span class="hljs-function"><span class="hljs-title">neg</span><span class="hljs-params">(<span class="hljs-number">1</span>,class(fix)</span></span>).
<span class="hljs-function"><span class="hljs-title">neg</span><span class="hljs-params">(<span class="hljs-number">1</span>,class(ok)</span></span>).
<span class="hljs-function"><span class="hljs-title">worn</span><span class="hljs-params">(<span class="hljs-number">1</span>,gear)</span></span>.
<span class="hljs-function"><span class="hljs-title">worn</span><span class="hljs-params">(<span class="hljs-number">1</span>,engine)</span></span>.
</code></pre>
                    <p>If we use this modality, facts for int/1 are not asserted for interpretations, but can be explicitily added by the user.</p>
                    <h4><a id="Fold_division_152"></a>Fold division</h4>
                    <p>After we defined the examples/interpretations we must indicate how the examples are divided in folds with facts of the form:</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">fold</span><span class="hljs-params">(&lt;fold_name&gt;,&lt;list of model identifiers&gt;)</span></span>
</code></pre>
                    <p>as for example</p>
                    <pre><code class="language-{.pl}">fold(train1,[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]).
fold(train2,[<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>]).
</code></pre>
                    <p>We can also define intensionally the folds as in</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">fold</span><span class="hljs-params">(all,F)</span></span> :- <span class="hljs-function"><span class="hljs-title">findall</span><span class="hljs-params">(I,int(I)</span></span>,F).
</code></pre>
                    <h2><a id="Full_dataset_167"></a>Full dataset</h2>
                    <p>The complete Machines input file is</p>
                    <div class="nb-cell program prolog"><pre><code class="language-{.pl}">% PREAMBLE %
:- use_module(library(slipcover)).
% use the renderer 'lpad'. It not mandatory to use it, but it prints the learned clauses in a more readable way
:- use_rendering(lpad).
:- sc.
:- set_sc(depth_bound,<span class="hljs-keyword">false</span>).
:- set_sc(neg_ex,given).
:- set_sc(megaex_bottom,15).
:- set_sc(max_iter,10).
:- set_sc(max_iter_structure,50).
:- set_sc(verbosity,1).

% BACKGROUND KNOWLEDGE %
:- begin_bg.
component(C):-
  replaceable(C).
component(C):-
  not_replaceable(C).
replaceable(gear).
replaceable(wheel).
replaceable(chain).
not_replaceable(engine).
not_replaceable(control_unit).
not_worn(C):-
  component(C),
  \+ worn(C).
one_worn:-
  worn(_).
none_worn:-
  \+ one_worn.
:- end_bg.
% INITIAL PROGRAM %
:- begin_in.
class(sendback):0.5 :-
  worn(A),
  not_replaceable(A).

class(fix):0.6 :-
  worn(A),
  replaceable(A).

class(ok):0.5 :-
  not_worn(_A).
:- end_in. 

% LANGUAGE BIAS %
% output predicates
output(class/1).
% input closed world predicates
input_cw(replaceable/1).
input_cw(not_replaceable/1).
input_cw(worn/1).
input_cw(not_worn/1).
input_cw(none_worn/0).

% EXAMPLES (interpretations) %
begin(model(1)).
class(sendback).
neg(class(fix)).
neg(class(ok)).
worn(gear).
worn(engine).
end(model(1)).

begin(model(2)).
class(ok).
neg(class(sendback)).
neg(class(fix)).
end(model(2)).

begin(model(3)).
class(fix).
neg(class(sendback)).
neg(class(ok)).
worn(gear).
end(model(3)).

begin(model(4)).
class(sendback).
neg(class(fix)).
neg(class(ok)).
worn(engine).
end(model(4)).

begin(model(5)).
class(fix).
neg(class(sendback)).
neg(class(ok)).
worn(gear).
worn(chain).
end(model(5)).

begin(model(6)).
class(fix).
neg(class(sendback)).
neg(class(ok)).
worn(wheel).
end(model(6)).

begin(model(7)).
class(sendback).
neg(class(fix)).
neg(class(ok)).
worn(wheel).
worn(control_unit).
end(model(7)).

begin(model(8)).
class(ok).
neg(class(sendback)).
neg(class(fix)).
end(model(8)).

begin(model(9)).
class(fix).
neg(class(sendback)).
neg(class(ok)).
worn(wheel).
worn(chain).
end(model(9)).

begin(model(10)).
class(sendback).
neg(class(fix)).
neg(class(ok)).
worn(engine).
worn(chain).
end(model(10)).

begin(model(11)).
class(sendback).
neg(class(fix)).
neg(class(ok)).
worn(engine).
worn(control_unit).
end(model(11)).

begin(model(12)).
class(fix).
neg(class(sendback)).
neg(class(ok)).
worn(chain).
worn(wheel).
worn(gear).
end(model(12)).

begin(model(13)).
class(sendback).
neg(class(fix)).
neg(class(ok)).
worn(chain).
worn(wheel).
worn(gear).
worn(engine).
end(model(13)).

begin(model(14)).
class(ok).
neg(class(sendback)).
neg(class(fix)).
end(model(14)).

begin(model(15)).
class(fix).
neg(class(sendback)).
neg(class(ok)).
worn(wheel).
worn(gear).
end(model(15)).

fold(all, F) :- findall(I,<span class="hljs-keyword">int</span>(I),F).
</code></pre></div>
                    <h3><a id="Performing_parameter_learning_354"></a>Performing parameter learning</h3>
                    <p>To execute the parameter learning algorithm EMBLEM, we need to ask a query of the form</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">induce_par</span><span class="hljs-params">(&lt;list of folds&gt;,P)</span></span>.
</code></pre>
                    <p>where <code>&lt;list of folds&gt;</code> is a list of the folds for training and <code>P</code> will contain the
                        input program with updated parameters.</p>
                    <p>In our example we want to learn the parameters by using the fold which contains all the examples (<code>all</code>). Therefore</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">induce_par</span><span class="hljs-params">([all],P)</span></span>.
</code></pre></div>
                    <hr>
                    <p>Complete example: <a target="_blank" href="http://cplint.lamping.unife.it/example/learning/mach.pl">mach.pl</a></p>
                    <hr>
                    <ul>
                        <li>Reference: The ACE Data Mining System User’s Manual <a target="_blank" href="https://dtai.cs.kuleuven.be/ACE/doc/ACEuser-1.2.16.pdf">https://dtai.cs.kuleuven.be/ACE/doc/ACEuser-1.2.16.pdf</a></li>
                    </ul>
                    <hr>
                    <p>For more information about how to perform learning and EMBLEM see the <a target="_blank" href="http://cplint.lamping.unife.it/help/help-cplint.html">manual</a> (or <a target="_blank" href="https://github.com/friguzzi/cplint/blob/master/doc/help-cplint.pdf">PDF version</a>) and the references in the <a target="_blank" href="http://cplint.lamping.unife.it/help/about.html#emblem">About page</a>:</p>
                    <hr>
                    <p><a href="#index">Back to Index</a></p>

                </div>
                <hr/>
                <div id="registration">
                    <h1><a id="Registration_0"></a>Registration</h1>
                    <p>In this tutorial section we will show how to perform structure learning. We take into account the Registration dataset (see reference).</p>
                    <p><strong>Note</strong>: the learning algorithms are available only if you use the Prolog editor.</p>
                    <h2><a id="Writing_the_program_step_by_step_5"></a>Writing the program step by step</h2>
                    <p>To execute a learning algorithm the input source must be divided in five parts:</p>
                    <ul>
                        <li>preamble,</li>
                        <li>background knowledge, i.e., knowledge valid for all interpretations,</li>
                        <li>Initial LPAD (optional),</li>
                        <li>language bias information,</li>
                        <li>example interpretations.</li>
                    </ul>
                    <p>Here we will define a program step by step and then execute the algorithm SLIPCOVER [2] which learns the structure and the parameters given a background knowledge.</p>
                    <p>For more information of how to perform learning see the <a target="_blank" href="http://cplint.lamping.unife.it/help/help-cplint.html">manual</a> (<a target="_blank" href="https://github.com/friguzzi/cplint/blob/master/doc/help-cplint.pdf">PDF version</a>).</p>
                    <h3><a id="Preamble_17"></a>Preamble</h3>
                    <p>We load the library <code>slipcover</code>, initialize it and then set some parameters.</p>
                    <pre><code class="language-{.pl}">:-<span class="hljs-function"><span class="hljs-title">use_module</span><span class="hljs-params">(library(slipcover)</span></span>).
:-sc.

:- <span class="hljs-function"><span class="hljs-title">set_sc</span><span class="hljs-params">(depth_bound,false)</span></span>.
:- <span class="hljs-function"><span class="hljs-title">set_sc</span><span class="hljs-params">(neg_ex,given)</span></span>.
:- <span class="hljs-function"><span class="hljs-title">set_sc</span><span class="hljs-params">(megaex_bottom,<span class="hljs-number">7</span>)</span></span>.
:- <span class="hljs-function"><span class="hljs-title">set_sc</span><span class="hljs-params">(verbosity,<span class="hljs-number">1</span>)</span></span>.
</code></pre>
                    <h3><a id="Backgroud_knowledge_29"></a>Backgroud knowledge</h3>
                    <p>Now we write the background knowledge enclosed by <code>:- begin_bg.</code> and <code>:- end_bg.</code>.</p>
                    <pre><code class="language-{.pl}">:- begin_bg.
<span class="hljs-function"><span class="hljs-title">company_info</span><span class="hljs-params">(jvt,commercial)</span></span>.
<span class="hljs-function"><span class="hljs-title">company_info</span><span class="hljs-params">(scuf,university)</span></span>.
<span class="hljs-function"><span class="hljs-title">company_info</span><span class="hljs-params">(ucro,university)</span></span>.
<span class="hljs-function"><span class="hljs-title">course</span><span class="hljs-params">(cso,<span class="hljs-number">2</span>,introductory)</span></span>.
<span class="hljs-function"><span class="hljs-title">course</span><span class="hljs-params">(erm,<span class="hljs-number">3</span>,introductory)</span></span>.
<span class="hljs-function"><span class="hljs-title">course</span><span class="hljs-params">(so2,<span class="hljs-number">4</span>,introductory)</span></span>.
<span class="hljs-function"><span class="hljs-title">course</span><span class="hljs-params">(srw,<span class="hljs-number">3</span>,advanced)</span></span>.

<span class="hljs-function"><span class="hljs-title">job</span><span class="hljs-params">(J)</span></span>:- <span class="hljs-function"><span class="hljs-title">participant</span><span class="hljs-params">(J, _, _, _)</span></span>.
<span class="hljs-function"><span class="hljs-title">company</span><span class="hljs-params">(C)</span></span>:- <span class="hljs-function"><span class="hljs-title">participant</span><span class="hljs-params">(_, C, _, _)</span></span>.

party_yes :- <span class="hljs-function"><span class="hljs-title">party</span><span class="hljs-params">(yes)</span></span>.
party_no :- <span class="hljs-function"><span class="hljs-title">party</span><span class="hljs-params">(no)</span></span>.

<span class="hljs-function"><span class="hljs-title">company_type</span><span class="hljs-params">(T)</span></span>:- <span class="hljs-function"><span class="hljs-title">company</span><span class="hljs-params">(C)</span></span>, <span class="hljs-function"><span class="hljs-title">company_info</span><span class="hljs-params">(C, T)</span></span>.

<span class="hljs-function"><span class="hljs-title">not_company_type</span><span class="hljs-params">(commercial)</span></span>:- \+ <span class="hljs-function"><span class="hljs-title">company_type</span><span class="hljs-params">(commercial)</span></span>.

<span class="hljs-function"><span class="hljs-title">not_company_type</span><span class="hljs-params">(university)</span></span>:- \+ <span class="hljs-function"><span class="hljs-title">company_type</span><span class="hljs-params">(university)</span></span>.

<span class="hljs-function"><span class="hljs-title">course_len</span><span class="hljs-params">(C, L)</span></span>:-
    <span class="hljs-function"><span class="hljs-title">course</span><span class="hljs-params">(C, L, _)</span></span>.
    
<span class="hljs-function"><span class="hljs-title">course_type</span><span class="hljs-params">(C, T)</span></span>:-
    <span class="hljs-function"><span class="hljs-title">course</span><span class="hljs-params">(C, _, T)</span></span>.

:- end_bg.
</code></pre>
                    <h3><a id="Initial_program_62"></a>Initial program</h3>
                    <p>You can define an inital LPAD program enclosed by <code>:- begin_in.</code> and <code>:- end_in.</code>.</p>
                    <pre><code>:- begin_in.
<span class="hljs-function"><span class="hljs-title">party</span><span class="hljs-params">(yes)</span></span>:<span class="hljs-number">0.5</span>:-
  <span class="hljs-function"><span class="hljs-title">company_type</span><span class="hljs-params">(commercial)</span></span>.

<span class="hljs-function"><span class="hljs-title">party</span><span class="hljs-params">(no)</span></span>:<span class="hljs-number">0.5</span>:-
  <span class="hljs-function"><span class="hljs-title">subscription</span><span class="hljs-params">(A)</span></span>,
  <span class="hljs-function"><span class="hljs-title">course_len</span><span class="hljs-params">(A,<span class="hljs-number">4</span>)</span></span>,
  \+ <span class="hljs-function"><span class="hljs-title">company_type</span><span class="hljs-params">(commercial)</span></span>.
:- end_in.
</code></pre>
                    <p>This LPAD is not used for structure learning. It can be used however for testing the program on the data, see the <a href="#bongard">Bongard</a> example.</p>
                    <h3><a id="Language_Bias_77"></a>Language Bias</h3>
                    <p>As in the <a href="#mach">previous example</a> we define the set of output and input predicates</p>
                    <pre><code class="language-{.pl}"><span class="hljs-comment">% output predicates</span>
<span class="hljs-atom">output</span>(<span class="hljs-atom">party</span>/<span class="hljs-number">1</span>).
<span class="hljs-comment">% input closed world predicates</span>
<span class="hljs-atom">input_cw</span>(<span class="hljs-atom">job</span>/<span class="hljs-number">1</span>).
<span class="hljs-atom">input_cw</span>(<span class="hljs-atom">not_company_type</span>/<span class="hljs-number">1</span>).
<span class="hljs-atom">input_cw</span>(<span class="hljs-atom">company_type</span>/<span class="hljs-number">1</span>).
<span class="hljs-atom">input_cw</span>(<span class="hljs-atom">subscription</span>/<span class="hljs-number">1</span>).
<span class="hljs-atom">input_cw</span>(<span class="hljs-atom">course_len</span>/<span class="hljs-number">2</span>).
<span class="hljs-atom">input_cw</span>(<span class="hljs-atom">course_type</span>/<span class="hljs-number">2</span>).
<span class="hljs-atom">input_cw</span>(<span class="hljs-atom">company</span>/<span class="hljs-number">1</span>).
<span class="hljs-atom">input_cw</span>(<span class="hljs-atom">company_info</span>/<span class="hljs-number">2</span>).
<span class="hljs-atom">input_cw</span>(<span class="hljs-atom">participant</span>/<span class="hljs-number">4</span>).
<span class="hljs-atom">input_cw</span>(<span class="hljs-atom">course</span>/<span class="hljs-number">3</span>).
</code></pre>
                    <p>We want to learn new clauses (the structure) for the program, in order to do that we need to add mode declarations in the style of <a target="_blank" href="http://www.doc.ic.ac.uk/~shm/progol.html">Progol</a>.</p>
                    <p>To specify the atoms that can appear in the head of clauses you must use facts of the form</p>
                    <pre><code class="language-{.pl}">modeh(<span class="hljs-tag">&lt;<span class="hljs-title">recall</span>&gt;</span>,<span class="hljs-tag">&lt;<span class="hljs-title">predicate</span>&gt;</span>(<span class="hljs-tag">&lt;<span class="hljs-title">arg1</span>&gt;</span>,...)).
</code></pre>
                    <p>To specify the atoms that can appear in the body of clauses you must use facts of the form</p>
                    <pre><code class="language-{.pl}">modeb(<span class="hljs-tag">&lt;<span class="hljs-title">recall</span>&gt;</span>,<span class="hljs-tag">&lt;<span class="hljs-title">predicate</span>&gt;</span>(<span class="hljs-tag">&lt;<span class="hljs-title">arg1</span>&gt;</span>,...)).
</code></pre>
                    <p>where <code>&lt;recall&gt;</code> can be an integer or *. <code>&lt;recall&gt;</code> indicates how many atoms for the predicate specification are retained in the bottom clause during a saturation step. * stands for all those that are found.</p>
                    <p>We refer to the <a target="_blank" href="http://cplint.lamping.unife.it/help/help-cplint.html">manual</a> for further details.</p>
                    <p>In our example we use the following mode declarations</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">modeh</span><span class="hljs-params">(*,party(yes)</span></span>).
<span class="hljs-function"><span class="hljs-title">modeh</span><span class="hljs-params">(*,party(no)</span></span>).

<span class="hljs-function"><span class="hljs-title">modeb</span><span class="hljs-params">(*,job(-#job)</span></span>).
<span class="hljs-function"><span class="hljs-title">modeb</span><span class="hljs-params">(*,company_type(-#ctype)</span></span>).
<span class="hljs-function"><span class="hljs-title">modeb</span><span class="hljs-params">(*,not_company_type(-#ctype)</span></span>).
<span class="hljs-function"><span class="hljs-title">modeb</span><span class="hljs-params">(*,subscription(-sub)</span></span>).
<span class="hljs-function"><span class="hljs-title">modeb</span><span class="hljs-params">(*,course_len(+sub,-#cl)</span></span>).
<span class="hljs-function"><span class="hljs-title">modeb</span><span class="hljs-params">(*,course_type(+sub,-#ct)</span></span>).
</code></pre>
                    <p>SLIPCOVER also requires facts for the determination/2 predicate Aleph-style that indicate which predicates can appear in the body of clauses. For our program we have</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">determination</span><span class="hljs-params">(party/<span class="hljs-number">1</span>,job/<span class="hljs-number">1</span>)</span></span>.
<span class="hljs-function"><span class="hljs-title">determination</span><span class="hljs-params">(party/<span class="hljs-number">1</span>,not_company_type/<span class="hljs-number">1</span>)</span></span>.
<span class="hljs-function"><span class="hljs-title">determination</span><span class="hljs-params">(party/<span class="hljs-number">1</span>,company_type/<span class="hljs-number">1</span>)</span></span>.
<span class="hljs-function"><span class="hljs-title">determination</span><span class="hljs-params">(party/<span class="hljs-number">1</span>,subscription/<span class="hljs-number">1</span>)</span></span>.
<span class="hljs-function"><span class="hljs-title">determination</span><span class="hljs-params">(party/<span class="hljs-number">1</span>,course_len/<span class="hljs-number">2</span>)</span></span>.
<span class="hljs-function"><span class="hljs-title">determination</span><span class="hljs-params">(party/<span class="hljs-number">1</span>,course_type/<span class="hljs-number">2</span>)</span></span>.
</code></pre>
                    <p>For example the first determination/2 fact states that the predicate job/1 can appear in the body of hypothesised clauses having party/1 in the head.</p>
                    <h3><a id="Example_interpretations_135"></a>Example interpretations</h3>
                    <p>Now we define the example models (or interpretations, i.e. a set of ground facts) and divide them in folds. You can specify data with two modalities: models and keys.</p>
                    <p>In the models type, you specify an example model (or interpretation) as a list of Prolog facts initiated by <code>begin(model(&lt;name&gt;)).</code> and terminated by <code>end(model(&lt;name&gt;)).</code>.</p>
                    <p>Alternatively, with the keys modality, you can directly write the facts and the first argument will be interpreted as a model identifier.</p>
                    <p>The two modalities, models and keys, can be mixed in the same source.</p>
                    <p>In this example and for the rest of the section we will use the former modality.</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">begin</span><span class="hljs-params">(model(adams)</span></span>).
<span class="hljs-function"><span class="hljs-title">participant</span><span class="hljs-params">(researcher,scuf,no,<span class="hljs-number">23</span>)</span></span>.
<span class="hljs-function"><span class="hljs-title">subscription</span><span class="hljs-params">(erm)</span></span>.
<span class="hljs-function"><span class="hljs-title">subscription</span><span class="hljs-params">(so2)</span></span>.
<span class="hljs-function"><span class="hljs-title">subscription</span><span class="hljs-params">(srw)</span></span>.
<span class="hljs-function"><span class="hljs-title">end</span><span class="hljs-params">(model(adams)</span></span>).
</code></pre>
                    <p>We can add background knowledge that is not probabilistic directly to the file writing the clauses taking into account the model argument. In our example</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">party</span><span class="hljs-params">(M,P)</span></span>:-
  <span class="hljs-function"><span class="hljs-title">participant</span><span class="hljs-params">(M,_, _, P, _)</span></span>.
</code></pre>
                    <p>Here M is the model and participant/4 is defined in the interpretations. You can also define intensionally the negative examples with</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">neg</span><span class="hljs-params">(party(M,yes)</span></span>):- <span class="hljs-function"><span class="hljs-title">party</span><span class="hljs-params">(M,no)</span></span>.
<span class="hljs-function"><span class="hljs-title">neg</span><span class="hljs-params">(party(M,no)</span></span>):- <span class="hljs-function"><span class="hljs-title">party</span><span class="hljs-params">(M,yes)</span></span>.
</code></pre>
                    <p>Now we split the example models into fold. In this example we have only one fold which contains all the models.</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">fold</span><span class="hljs-params">(all,F)</span></span> :- <span class="hljs-function"><span class="hljs-title">findall</span><span class="hljs-params">(I,int(I)</span></span>,F).
</code></pre>
                    <h2><a id="Full_program_171"></a>Full program</h2>
                    <p>Below there is the complete program</p>
                    <div class="nb-cell program prolog"><pre><code class="language-{.pl}"><span class="hljs-comment">% PREAMBLE %</span>
:- <span class="hljs-atom">use_module</span>(<span class="hljs-atom">library</span>(<span class="hljs-atom">slipcover</span>)).
<span class="hljs-comment">% use the renderer 'lpad'. It not mandatory to use it, but it prints the learned clauses in a more readable way</span>
:- <span class="hljs-atom">use_rendering</span>(<span class="hljs-atom">lpad</span>).
:- <span class="hljs-atom">sc</span>.
:- <span class="hljs-atom">set_sc</span>(<span class="hljs-atom">depth_bound</span>,<span class="hljs-atom">false</span>).
:- <span class="hljs-atom">set_sc</span>(<span class="hljs-atom">neg_ex</span>,<span class="hljs-atom">given</span>).
:- <span class="hljs-atom">set_sc</span>(<span class="hljs-atom">megaex_bottom</span>,<span class="hljs-number">7</span>).
:- <span class="hljs-atom">set_sc</span>(<span class="hljs-atom">verbosity</span>,<span class="hljs-number">1</span>).

<span class="hljs-comment">% BACKGROUND KNOWLEDGE %</span>
:- <span class="hljs-atom">begin_bg</span>.
<span class="hljs-atom">company_info</span>(<span class="hljs-atom">jvt</span>,<span class="hljs-atom">commercial</span>).
<span class="hljs-atom">company_info</span>(<span class="hljs-atom">scuf</span>,<span class="hljs-atom">university</span>).
<span class="hljs-atom">company_info</span>(<span class="hljs-atom">ucro</span>,<span class="hljs-atom">university</span>).
<span class="hljs-atom">course</span>(<span class="hljs-atom">cso</span>,<span class="hljs-number">2</span>,<span class="hljs-atom">introductory</span>).
<span class="hljs-atom">course</span>(<span class="hljs-atom">erm</span>,<span class="hljs-number">3</span>,<span class="hljs-atom">introductory</span>).
<span class="hljs-atom">course</span>(<span class="hljs-atom">so2</span>,<span class="hljs-number">4</span>,<span class="hljs-atom">introductory</span>).
<span class="hljs-atom">course</span>(<span class="hljs-atom">srw</span>,<span class="hljs-number">3</span>,<span class="hljs-atom">advanced</span>).

<span class="hljs-atom">job</span>(<span class="hljs-name">J</span>):- <span class="hljs-atom">participant</span>(<span class="hljs-name">J</span>, <span class="hljs-name">_</span>, <span class="hljs-name">_</span>, <span class="hljs-name">_</span>).
<span class="hljs-atom">company</span>(<span class="hljs-name">C</span>):- <span class="hljs-atom">participant</span>(<span class="hljs-name">_</span>, <span class="hljs-name">C</span>, <span class="hljs-name">_</span>, <span class="hljs-name">_</span>).

<span class="hljs-atom">party_yes</span> :- <span class="hljs-atom">party</span>(<span class="hljs-atom">yes</span>).
<span class="hljs-atom">party_no</span> :- <span class="hljs-atom">party</span>(<span class="hljs-atom">no</span>).

<span class="hljs-atom">company_type</span>(<span class="hljs-name">T</span>):- <span class="hljs-atom">company</span>(<span class="hljs-name">C</span>), <span class="hljs-atom">company_info</span>(<span class="hljs-name">C</span>, <span class="hljs-name">T</span>).
<span class="hljs-atom">not_company_type</span>(<span class="hljs-atom">commercial</span>):- \+ <span class="hljs-atom">company_type</span>(<span class="hljs-atom">commercial</span>).
<span class="hljs-atom">not_company_type</span>(<span class="hljs-atom">university</span>):- \+ <span class="hljs-atom">company_type</span>(<span class="hljs-atom">university</span>).

<span class="hljs-atom">course_len</span>(<span class="hljs-name">C</span>, <span class="hljs-name">L</span>):- <span class="hljs-atom">course</span>(<span class="hljs-name">C</span>, <span class="hljs-name">L</span>, <span class="hljs-name">_</span>).
<span class="hljs-atom">course_type</span>(<span class="hljs-name">C</span>, <span class="hljs-name">T</span>):- <span class="hljs-atom">course</span>(<span class="hljs-name">C</span>, <span class="hljs-name">_</span>, <span class="hljs-name">T</span>).
:- <span class="hljs-atom">end_bg</span>.
<span class="hljs-comment">%%%%%%%%%%%%%%%%%%%</span>
<span class="hljs-comment">% INITIAL PROGRAM %</span>
<span class="hljs-comment">%%%%%%%%%%%%%%%%%%%</span>
:- <span class="hljs-atom">begin_in</span>.
<span class="hljs-atom">party</span>(<span class="hljs-atom">yes</span>):<span class="hljs-number">0.5</span>:-
  <span class="hljs-atom">company_type</span>(<span class="hljs-atom">commercial</span>).

<span class="hljs-atom">party</span>(<span class="hljs-atom">no</span>):<span class="hljs-number">0.5</span>:-
  <span class="hljs-atom">subscription</span>(<span class="hljs-name">A</span>),
  <span class="hljs-atom">course_len</span>(<span class="hljs-name">A</span>,<span class="hljs-number">4</span>),
  \+ <span class="hljs-atom">company_type</span>(<span class="hljs-atom">commercial</span>).
:- <span class="hljs-atom">end_in</span>.

<span class="hljs-comment">% LANGUAGE BIAS %</span>
<span class="hljs-comment">% output predicates</span>
<span class="hljs-atom">output</span>(<span class="hljs-atom">party</span>/<span class="hljs-number">1</span>).
<span class="hljs-comment">% input closed world predicates</span>
<span class="hljs-atom">input_cw</span>(<span class="hljs-atom">job</span>/<span class="hljs-number">1</span>).
<span class="hljs-atom">input_cw</span>(<span class="hljs-atom">not_company_type</span>/<span class="hljs-number">1</span>).
<span class="hljs-atom">input_cw</span>(<span class="hljs-atom">company_type</span>/<span class="hljs-number">1</span>).
<span class="hljs-atom">input_cw</span>(<span class="hljs-atom">subscription</span>/<span class="hljs-number">1</span>).
<span class="hljs-atom">input_cw</span>(<span class="hljs-atom">course_len</span>/<span class="hljs-number">2</span>).
<span class="hljs-atom">input_cw</span>(<span class="hljs-atom">course_type</span>/<span class="hljs-number">2</span>).
<span class="hljs-atom">input_cw</span>(<span class="hljs-atom">company</span>/<span class="hljs-number">1</span>).
<span class="hljs-atom">input_cw</span>(<span class="hljs-atom">company_info</span>/<span class="hljs-number">2</span>).
<span class="hljs-atom">input_cw</span>(<span class="hljs-atom">participant</span>/<span class="hljs-number">4</span>).
<span class="hljs-atom">input_cw</span>(<span class="hljs-atom">course</span>/<span class="hljs-number">3</span>).

<span class="hljs-atom">determination</span>(<span class="hljs-atom">party</span>/<span class="hljs-number">1</span>,<span class="hljs-atom">job</span>/<span class="hljs-number">1</span>).
<span class="hljs-atom">determination</span>(<span class="hljs-atom">party</span>/<span class="hljs-number">1</span>,<span class="hljs-atom">not_company_type</span>/<span class="hljs-number">1</span>).
<span class="hljs-atom">determination</span>(<span class="hljs-atom">party</span>/<span class="hljs-number">1</span>,<span class="hljs-atom">company_type</span>/<span class="hljs-number">1</span>).
<span class="hljs-atom">determination</span>(<span class="hljs-atom">party</span>/<span class="hljs-number">1</span>,<span class="hljs-atom">subscription</span>/<span class="hljs-number">1</span>).
<span class="hljs-atom">determination</span>(<span class="hljs-atom">party</span>/<span class="hljs-number">1</span>,<span class="hljs-atom">course_len</span>/<span class="hljs-number">2</span>).
<span class="hljs-atom">determination</span>(<span class="hljs-atom">party</span>/<span class="hljs-number">1</span>,<span class="hljs-atom">course_type</span>/<span class="hljs-number">2</span>).

<span class="hljs-atom">modeh</span>(*,<span class="hljs-atom">party</span>(<span class="hljs-atom">yes</span>)).
<span class="hljs-atom">modeh</span>(*,<span class="hljs-atom">party</span>(<span class="hljs-atom">no</span>)).

<span class="hljs-atom">modeb</span>(*,<span class="hljs-atom">job</span>(-#<span class="hljs-atom">job</span>)).
<span class="hljs-atom">modeb</span>(*,<span class="hljs-atom">company_type</span>(-#<span class="hljs-atom">ctype</span>)).
<span class="hljs-atom">modeb</span>(*,<span class="hljs-atom">not_company_type</span>(-#<span class="hljs-atom">ctype</span>)).
<span class="hljs-atom">modeb</span>(*,<span class="hljs-atom">subscription</span>(-<span class="hljs-atom">sub</span>)).
<span class="hljs-atom">modeb</span>(*,<span class="hljs-atom">course_len</span>(+<span class="hljs-atom">sub</span>,-#<span class="hljs-atom">cl</span>)).
<span class="hljs-atom">modeb</span>(*,<span class="hljs-atom">course_type</span>(+<span class="hljs-atom">sub</span>,-#<span class="hljs-atom">ct</span>)).

<span class="hljs-comment">% EXAMPLES (interpretations) %</span>
<span class="hljs-atom">neg</span>(<span class="hljs-atom">party</span>(<span class="hljs-name">M</span>,<span class="hljs-atom">yes</span>)):- <span class="hljs-atom">party</span>(<span class="hljs-name">M</span>,<span class="hljs-atom">no</span>).
<span class="hljs-atom">neg</span>(<span class="hljs-atom">party</span>(<span class="hljs-name">M</span>,<span class="hljs-atom">no</span>)):- <span class="hljs-atom">party</span>(<span class="hljs-name">M</span>,<span class="hljs-atom">yes</span>).

<span class="hljs-atom">party</span>(<span class="hljs-name">M</span>,<span class="hljs-name">P</span>):-
  <span class="hljs-atom">participant</span>(<span class="hljs-name">M</span>,<span class="hljs-name">_</span>, <span class="hljs-name">_</span>, <span class="hljs-name">P</span>, <span class="hljs-name">_</span>).

<span class="hljs-atom">begin</span>(<span class="hljs-atom">model</span>(<span class="hljs-atom">adams</span>)).
<span class="hljs-atom">participant</span>(<span class="hljs-atom">researcher</span>,<span class="hljs-atom">scuf</span>,<span class="hljs-atom">no</span>,<span class="hljs-number">23</span>).
<span class="hljs-atom">subscription</span>(<span class="hljs-atom">erm</span>).
<span class="hljs-atom">subscription</span>(<span class="hljs-atom">so2</span>).
<span class="hljs-atom">subscription</span>(<span class="hljs-atom">srw</span>).
<span class="hljs-atom">end</span>(<span class="hljs-atom">model</span>(<span class="hljs-atom">adams</span>)).

<span class="hljs-atom">begin</span>(<span class="hljs-atom">model</span>(<span class="hljs-atom">blake</span>)).
<span class="hljs-atom">participant</span>(<span class="hljs-atom">president</span>,<span class="hljs-atom">jvt</span>,<span class="hljs-atom">yes</span>,<span class="hljs-number">5</span>).
<span class="hljs-atom">subscription</span>(<span class="hljs-atom">cso</span>).
<span class="hljs-atom">subscription</span>(<span class="hljs-atom">erm</span>).
<span class="hljs-atom">end</span>(<span class="hljs-atom">model</span>(<span class="hljs-atom">blake</span>)).

<span class="hljs-atom">begin</span>(<span class="hljs-atom">model</span>(<span class="hljs-atom">king</span>)).
<span class="hljs-atom">participant</span>(<span class="hljs-atom">manager</span>,<span class="hljs-atom">ucro</span>,<span class="hljs-atom">no</span>,<span class="hljs-number">78</span>).
<span class="hljs-atom">subscription</span>(<span class="hljs-atom">cso</span>).
<span class="hljs-atom">subscription</span>(<span class="hljs-atom">erm</span>).
<span class="hljs-atom">subscription</span>(<span class="hljs-atom">so2</span>).
<span class="hljs-atom">subscription</span>(<span class="hljs-atom">srw</span>).
<span class="hljs-atom">end</span>(<span class="hljs-atom">model</span>(<span class="hljs-atom">king</span>)).

<span class="hljs-atom">begin</span>(<span class="hljs-atom">model</span>(<span class="hljs-atom">miller</span>)).
<span class="hljs-atom">participant</span>(<span class="hljs-atom">manager</span>,<span class="hljs-atom">jvt</span>,<span class="hljs-atom">yes</span>,<span class="hljs-number">14</span>).
<span class="hljs-atom">subscription</span>(<span class="hljs-atom">so2</span>).
<span class="hljs-atom">end</span>(<span class="hljs-atom">model</span>(<span class="hljs-atom">miller</span>)).

<span class="hljs-atom">begin</span>(<span class="hljs-atom">model</span>(<span class="hljs-atom">scott</span>)).
<span class="hljs-atom">participant</span>(<span class="hljs-atom">researcher</span>,<span class="hljs-atom">scuf</span>,<span class="hljs-atom">yes</span>,<span class="hljs-number">94</span>).
<span class="hljs-atom">subscription</span>(<span class="hljs-atom">erm</span>).
<span class="hljs-atom">subscription</span>(<span class="hljs-atom">srw</span>).
<span class="hljs-atom">end</span>(<span class="hljs-atom">model</span>(<span class="hljs-atom">scott</span>)).

<span class="hljs-atom">begin</span>(<span class="hljs-atom">model</span>(<span class="hljs-atom">turner</span>)).
<span class="hljs-atom">participant</span>(<span class="hljs-atom">researcher</span>,<span class="hljs-atom">ucro</span>,<span class="hljs-atom">no</span>,<span class="hljs-number">81</span>).
<span class="hljs-atom">subscription</span>(<span class="hljs-atom">so2</span>).
<span class="hljs-atom">subscription</span>(<span class="hljs-atom">srw</span>).
<span class="hljs-atom">end</span>(<span class="hljs-atom">model</span>(<span class="hljs-atom">turner</span>)).
<span class="hljs-comment">% fold division</span>
<span class="hljs-atom">fold</span>(<span class="hljs-atom">all</span>,<span class="hljs-name">F</span>) :- <span class="hljs-atom">findall</span>(<span class="hljs-name">I</span>,<span class="hljs-atom">int</span>(<span class="hljs-name">I</span>),<span class="hljs-name">F</span>).
</code></pre></div>
                    <h3><a id="Execute_parameter_learning_310"></a>Execute parameter learning</h3>
                    <p>In this example we provided an initial program, therefore we can perform parameter learning (we use all the example for training)</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">induce_par</span><span class="hljs-params">([all], P)</span></span>.
</code></pre></div>
                    <h3><a id="Execute_structure_learning_317"></a>Execute structure learning</h3>
                    <p>To execute the structure learning algorithm SLIPCOVER (which learns also the parameters of the learned program), we need to execute a query with the form</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">induce</span><span class="hljs-params">(&lt;list of folds&gt;,P)</span></span>.
</code></pre>
                    <p>where <code>&lt;list of folds&gt;</code> is a list of the folds for training and <code>P</code> will contain the learned program.</p>
                    <p>In our example we want to learn the structure (and the parameters) by using the fold which contains all the examples (<code>all</code>). Therefore</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">induce</span><span class="hljs-params">([all],P)</span></span>.
</code></pre></div>
                    <hr>
                    <p>Complete example: <a target="_blank" href="http://cplint.lamping.unife.it/example/learning/registration.pl">registration.pl</a></p>
                    <hr>
                    <ul>
                        <li>Reference: L. De Raedt, H. Blockeel, L. Dehaspe, and W. Van Laer. Three companions for data mining in first order logic. In S. Dzeroski and N. Lavrac, editors, Relational Data Mining, pages 105-139.  Springer-Verlag, 2001.</li>
                    </ul>
                    <hr>
                    <p>For more information about how to perform learning and SLIPCOVER see the <a target="_blank" href="http://cplint.lamping.unife.it/help/help-cplint.html">manual</a> (or <a target="_blank" href="https://github.com/friguzzi/cplint/blob/master/doc/help-cplint.pdf">PDF version</a>) and the references in the <a target="_blank" href="http://cplint.lamping.unife.it/help/about.html#slipcover">About page</a>.</p>
                    <hr>
                    <p><a href="#index">Back to Index</a></p>

                </div>
                <hr/>
                <div id="bongard">
                    <h1><a id="Bongard_0"></a>Bongard</h1>
                    <p>In this tutorial section we will see how to execute a test on a program. We take into account the Bongard dataset (see reference).</p>
                    <h2><a id="How_to_test_a_program_3"></a>How to test a program</h2>
                    <p>A program can also be tested on a test set with a query of the form</p>
                    <pre><code class="language-{.pl}">?- <span class="hljs-keyword">test</span>(&lt;<span class="hljs-keyword">program</span>&gt;,&lt;list_of_folds&gt;,LL,AUCROC,ROC,AUCPR,<span class="hljs-keyword">PR</span>).
</code></pre>
                    <p>where <code>&lt;program&gt;</code> is a list of terms representing clauses and <code>&lt;list_of_folds&gt;</code> is a list of folds. This returns the log likelihood of the test examples in <code>LL</code>, the Area Under the ROC curve in <code>AUCROC</code>, a dictionary containing the list of points (in the form of Prolog pairs x-y) of the ROC curve in <code>ROC</code>, the Area Under the PR curve in AUCPR, a dictionary containing the list of points of the PR curve in <code>PR</code>.</p>
                    <p>Let us suppose now that we have two disjunt folds of examples named <code>train</code> and <code>test</code>. We will now see how to test a (learned) program.</p>
                    <h3><a id="How_to_test_the_initial_program_12"></a>How to test the initial program</h3>
                    <p>we can test the input program on the fold test with a query of the form</p>
                    <pre><code class="language-{.pl}">?- <span class="hljs-keyword">in</span>(P), <span class="hljs-keyword">test</span>(P,[<span class="hljs-keyword">test</span>],LL,AUCROC,ROC,AUCPR,<span class="hljs-keyword">PR</span>).
</code></pre>
                    <h3><a id="How_to_test_a_program_after_parameter_learning_18"></a>How to test a program after parameter learning</h3>
                    <p>Suppose we want to perform parameter learning on the initial program by using the <code>train</code> fold and then test the resulting program by using the <code>test</code> fold. Then we have just to run the query</p>
                    <pre><code class="language-{.pl}">?- <span class="hljs-function">induce_par</span>(<span class="hljs-attr_selector">[train]</span>,<span class="hljs-tag">P</span>), <span class="hljs-function">test</span>(<span class="hljs-tag">P</span>,<span class="hljs-attr_selector">[test]</span>,LL,AUCROC,ROC,AUCPR,PR).
</code></pre>
                    <h3><a id="How_to_test_the_learned_program_24"></a>How to test the learned program</h3>
                    <p>Suppose we want to learn new clauses (i.e. we perform structure learning) by using the <code>train</code> fold and then test the resulting program by using the <code>test</code> fold. Then we have just to run the query</p>
                    <pre><code class="language-{.pl}">?- <span class="hljs-function">induce</span>(<span class="hljs-attr_selector">[train]</span>,<span class="hljs-tag">P</span>), <span class="hljs-function">test</span>(<span class="hljs-tag">P</span>,<span class="hljs-attr_selector">[test]</span>,LL,AUCROC,ROC,AUCPR,PR).
</code></pre>
                    <h2><a id="Adding_renderers_30"></a>Adding renderers</h2>
                    <p>It is possible to see the curves AUCROC, ROC and PR as graphs by including the renderer <code>c3</code> before <code>:- sc.</code>. Morover we include the renderer <code>lpad</code> to have the output program pretty printed. Therefore we add the following commands in the preamble before <code>:- sc.</code>.</p>
                    <pre><code class="language-{.pl}">:- <span class="hljs-function"><span class="hljs-title">use_rendering</span><span class="hljs-params">(c3)</span></span>.
:- <span class="hljs-function"><span class="hljs-title">use_rendering</span><span class="hljs-params">(lpad)</span></span>.
</code></pre>
                    <h2><a id="Dynamic_folds_37"></a>Dynamic folds</h2>
                    <p>We can intensionally create the fold containing all the example with</p>
                    <pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">fold</span><span class="hljs-params">(all,F)</span></span>:- <span class="hljs-function"><span class="hljs-title">findall</span><span class="hljs-params">(I,int(I)</span></span>,F).
</code></pre>
                    <p>We can dinamically create the folds <code>train</code> and <code>test</code> with the following command</p>
                    <pre><code class="language-{.pl}">:- <span class="hljs-function"><span class="hljs-title">fold</span><span class="hljs-params">(all,F)</span></span>,
   <span class="hljs-function"><span class="hljs-title">sample</span><span class="hljs-params">(<span class="hljs-number">4</span>,F,FTr,FTe)</span></span>,
   <span class="hljs-function"><span class="hljs-title">assert</span><span class="hljs-params">(fold(train,FTr)</span></span>),
   <span class="hljs-function"><span class="hljs-title">assert</span><span class="hljs-params">(fold(test,FTe)</span></span>).
</code></pre>
                    <p>This last command should however be inserted after the input interpretations. As can be seen, it uses <code>sample(N,List,Sampled,Rest)</code> exported from the library <code>slipcover</code> that samples <code>N</code> elements from <code>List</code> and returns the sampled elements in <code>Sampled</code> and the rest in <code>Rest</code>. If <code>List</code> has <code>N</code> elements or less, <code>Sampled</code> is equal to <code>List</code> and <code>Rest</code> is empty.</p>
                    <h2><a id="Full_dataset_52"></a>Full dataset</h2>
                    <p>Below the complete Bongard dataset is reported.</p>
                    <div class="nb-cell program prolog"><pre><code class="language-{.pl}">% <span class="hljs-tag">PREAMBLE</span> %
<span class="hljs-pseudo">:-use_module(library(slipcover))</span><span class="hljs-rule"><span class="hljs-attribute">.
</span>:<span class="hljs-value">- <span class="hljs-function">use_rendering</span>(c3).
:- <span class="hljs-function">use_rendering</span>(lpad).
:-sc.
:- <span class="hljs-function">set_sc</span>(megaex_bottom,<span class="hljs-number">20</span>).
:- <span class="hljs-function">set_sc</span>(max_iter,<span class="hljs-number">3</span>).
:- <span class="hljs-function">set_sc</span>(max_iter_structure,<span class="hljs-number">10</span>).
:- <span class="hljs-function">set_sc</span>(maxdepth_var,<span class="hljs-number">4</span>).
:- <span class="hljs-function">set_sc</span>(verbosity,<span class="hljs-number">1</span>).

% BACKGROUND KNOWLEDGE %
<span class="hljs-function">bg</span>([]).

% INITIAL PROGRAM %
<span class="hljs-function">in</span>([
(
 pos:<span class="hljs-number">0.5</span> :-
    <span class="hljs-function">circle</span>(A),
    <span class="hljs-function">in</span>(B,A)
),
( 
 pos:<span class="hljs-number">0.5</span> :-
    <span class="hljs-function">circle</span>(A),
    <span class="hljs-function">triangle</span>(B)
)]).

% LANGUAGE BIAS %
% output predicates
<span class="hljs-function">output</span>(pos/<span class="hljs-number">0</span>).
% input closed world predicates
<span class="hljs-function">input_cw</span>(triangle/<span class="hljs-number">1</span>).
<span class="hljs-function">input_cw</span>(square/<span class="hljs-number">1</span>).
<span class="hljs-function">input_cw</span>(circle/<span class="hljs-number">1</span>).
<span class="hljs-function">input_cw</span>(in/<span class="hljs-number">2</span>).
<span class="hljs-function">input_cw</span>(config/<span class="hljs-number">2</span>).
% mode declarations
<span class="hljs-function">modeh</span>(*,pos).
<span class="hljs-function">modeb</span>(*,<span class="hljs-function">triangle</span>(-obj)).
<span class="hljs-function">modeb</span>(*,<span class="hljs-function">square</span>(-obj)).
<span class="hljs-function">modeb</span>(*,<span class="hljs-function">circle</span>(-obj)).
<span class="hljs-function">modeb</span>(*,<span class="hljs-function">in</span>(+obj,-obj)).
<span class="hljs-function">modeb</span>(*,<span class="hljs-function">in</span>(-obj,+obj)).
<span class="hljs-function">modeb</span>(*,<span class="hljs-function">config</span>(+obj,-<span class="hljs-hexcolor">#d</span>ir)).

<span class="hljs-function">determination</span>(pos/<span class="hljs-number">0</span>,triangle/<span class="hljs-number">1</span>).
<span class="hljs-function">determination</span>(pos/<span class="hljs-number">0</span>,square/<span class="hljs-number">1</span>).
<span class="hljs-function">determination</span>(pos/<span class="hljs-number">0</span>,circle/<span class="hljs-number">1</span>).
<span class="hljs-function">determination</span>(pos/<span class="hljs-number">0</span>,in/<span class="hljs-number">2</span>).
<span class="hljs-function">determination</span>(pos/<span class="hljs-number">0</span>,config/<span class="hljs-number">2</span>).

% EXAMPLES (interpretations) %
<span class="hljs-function">begin</span>(<span class="hljs-function">model</span>(<span class="hljs-number">1</span>)).
pos.
<span class="hljs-function">triangle</span>(o5).
<span class="hljs-function">config</span>(o5,up).
<span class="hljs-function">square</span>(o4).
<span class="hljs-function">in</span>(o4,o5).
<span class="hljs-function">circle</span>(o3).
<span class="hljs-function">triangle</span>(o2).
<span class="hljs-function">config</span>(o2,up).
<span class="hljs-function">in</span>(o2,o3).
<span class="hljs-function">triangle</span>(o1).
<span class="hljs-function">config</span>(o1,up).
<span class="hljs-function">end</span>(<span class="hljs-function">model</span>(<span class="hljs-number">1</span>)).

<span class="hljs-function">begin</span>(<span class="hljs-function">model</span>(<span class="hljs-number">2</span>)).
<span class="hljs-function">neg</span>(pos).
<span class="hljs-function">circle</span>(o4).
<span class="hljs-function">circle</span>(o3).
<span class="hljs-function">in</span>(o3,o4).
<span class="hljs-function">square</span>(o2).
<span class="hljs-function">circle</span>(o1).
<span class="hljs-function">in</span>(o1,o2).
<span class="hljs-function">end</span>(<span class="hljs-function">model</span>(<span class="hljs-number">2</span>)).

<span class="hljs-function">begin</span>(<span class="hljs-function">model</span>(<span class="hljs-number">3</span>)).
<span class="hljs-function">neg</span>(pos).
<span class="hljs-function">square</span>(o3).
<span class="hljs-function">square</span>(o2).
<span class="hljs-function">in</span>(o2,o3).
<span class="hljs-function">square</span>(o1).
<span class="hljs-function">end</span>(<span class="hljs-function">model</span>(<span class="hljs-number">3</span>)).

<span class="hljs-function">begin</span>(<span class="hljs-function">model</span>(<span class="hljs-number">4</span>)).
pos.
<span class="hljs-function">triangle</span>(o5).
<span class="hljs-function">config</span>(o5,down).
<span class="hljs-function">triangle</span>(o4).
<span class="hljs-function">config</span>(o4,up).
<span class="hljs-function">in</span>(o4,o5).
<span class="hljs-function">circle</span>(o3).
<span class="hljs-function">square</span>(o2).
<span class="hljs-function">in</span>(o2,o3).
<span class="hljs-function">triangle</span>(o1).
<span class="hljs-function">config</span>(o1,up).
<span class="hljs-function">end</span>(<span class="hljs-function">model</span>(<span class="hljs-number">4</span>)).

<span class="hljs-function">begin</span>(<span class="hljs-function">model</span>(<span class="hljs-number">5</span>)).
pos.
<span class="hljs-function">circle</span>(o4).
<span class="hljs-function">triangle</span>(o3).
<span class="hljs-function">config</span>(o3,up).
<span class="hljs-function">in</span>(o3,o4).
<span class="hljs-function">triangle</span>(o2).
<span class="hljs-function">config</span>(o2,down).
<span class="hljs-function">square</span>(o1).
<span class="hljs-function">in</span>(o1,o2).
<span class="hljs-function">end</span>(<span class="hljs-function">model</span>(<span class="hljs-number">5</span>)).

<span class="hljs-function">begin</span>(<span class="hljs-function">model</span>(<span class="hljs-number">6</span>)).
<span class="hljs-function">neg</span>(pos).
<span class="hljs-function">triangle</span>(o5).
<span class="hljs-function">config</span>(o5,down).
<span class="hljs-function">square</span>(o4).
<span class="hljs-function">in</span>(o4,o5).
<span class="hljs-function">circle</span>(o3).
<span class="hljs-function">circle</span>(o2).
<span class="hljs-function">in</span>(o2,o3).
<span class="hljs-function">triangle</span>(o1).
<span class="hljs-function">config</span>(o1,down).
<span class="hljs-function">end</span>(<span class="hljs-function">model</span>(<span class="hljs-number">6</span>)).

<span class="hljs-function">begin</span>(<span class="hljs-function">model</span>(<span class="hljs-number">7</span>)).
<span class="hljs-function">neg</span>(pos).
<span class="hljs-function">triangle</span>(o3).
<span class="hljs-function">config</span>(o3,down).
<span class="hljs-function">circle</span>(o2).
<span class="hljs-function">in</span>(o2,o3).
<span class="hljs-function">triangle</span>(o1).
<span class="hljs-function">config</span>(o1,down).
<span class="hljs-function">end</span>(<span class="hljs-function">model</span>(<span class="hljs-number">7</span>)).

<span class="hljs-function">begin</span>(<span class="hljs-function">model</span>(<span class="hljs-number">8</span>)).
<span class="hljs-function">neg</span>(pos).
<span class="hljs-function">triangle</span>(o4).
<span class="hljs-function">config</span>(o4,down).
<span class="hljs-function">circle</span>(o3).
<span class="hljs-function">in</span>(o3,o4).
<span class="hljs-function">triangle</span>(o2).
<span class="hljs-function">config</span>(o2,up).
<span class="hljs-function">circle</span>(o1).
<span class="hljs-function">in</span>(o1,o2).
<span class="hljs-function">end</span>(<span class="hljs-function">model</span>(<span class="hljs-number">8</span>)).

<span class="hljs-function">begin</span>(<span class="hljs-function">model</span>(<span class="hljs-number">9</span>)).
pos.
<span class="hljs-function">triangle</span>(o2).
<span class="hljs-function">config</span>(o2,down).
<span class="hljs-function">triangle</span>(o1).
<span class="hljs-function">config</span>(o1,down).
<span class="hljs-function">in</span>(o1,o2).
<span class="hljs-function">end</span>(<span class="hljs-function">model</span>(<span class="hljs-number">9</span>)).

<span class="hljs-function">begin</span>(<span class="hljs-function">model</span>(<span class="hljs-number">10</span>)).
pos.
<span class="hljs-function">triangle</span>(o6).
<span class="hljs-function">config</span>(o6,up).
<span class="hljs-function">triangle</span>(o5).
<span class="hljs-function">config</span>(o5,up).
<span class="hljs-function">in</span>(o5,o6).
<span class="hljs-function">square</span>(o4).
<span class="hljs-function">triangle</span>(o3).
<span class="hljs-function">config</span>(o3,up).
<span class="hljs-function">in</span>(o3,o4).
<span class="hljs-function">square</span>(o2).
<span class="hljs-function">triangle</span>(o1).
<span class="hljs-function">config</span>(o1,up).
<span class="hljs-function">in</span>(o1,o2).
<span class="hljs-function">end</span>(<span class="hljs-function">model</span>(<span class="hljs-number">10</span>)).
% fold division
<span class="hljs-function">fold</span>(all,F):- <span class="hljs-function">findall</span>(I,<span class="hljs-function">int</span>(I),F).

:- <span class="hljs-function">fold</span>(all,F),
   <span class="hljs-function">sample</span>(<span class="hljs-number">4</span>,F,FTr,FTe),
   <span class="hljs-function">assert</span>(<span class="hljs-function">fold</span>(train,FTr)),
   <span class="hljs-function">assert</span>(<span class="hljs-function">fold</span>(test,FTe)).
</span></span></code></pre></div>
                    <h3><a id="Execute_parameter_learning_and_test_244"></a>Execute parameter learning and test</h3>
                    <p>If we want to learn the parameters of the initial program and then test the resulting program, we can use the following query</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">induce_par</span><span class="hljs-params">([train],P)</span></span>, <span class="hljs-function"><span class="hljs-title">test</span><span class="hljs-params">(P,[test],LL,AUCROC,ROC,AUCPR,PR)</span></span>.
</code></pre></div>
                    <h3><a id="Execute_structure_learning_and_test_251"></a>Execute structure learning and test</h3>
                    <p>If we want to learn a program and then test it, we can use the following query</p>
                    <div class="nb-cell query"><pre><code class="language-{.pl}"><span class="hljs-function"><span class="hljs-title">induce</span><span class="hljs-params">([train],P)</span></span>, <span class="hljs-function"><span class="hljs-title">test</span><span class="hljs-params">(P,[test],LL,AUCROC,ROC,AUCPR,PR)</span></span>.
</code></pre></div>
                    <hr>
                    <p>Complete example: <a target="_blank" href="http://cplint.lamping.unife.it/example/learning/bongard.pl">bongard.pl</a></p>
                    <hr>
                    <ul>
                        <li>Reference: L. De Raedt and W. Van Laer. Inductive constraint logic. In Klaus P. Jantke, Takeshi Shinohara, and Thomas Zeugmann, editors, Proceedings of the Sixth International Workshop on Algorithmic Learning Theory, volume 997 of Lecture Notes in Artificial Intelligence, pages 80-94. SpringerVerlag, 1995.</li>
                    </ul>
                    <hr>
                    <p>For more information about how to perform learning see the <a target="_blank" href="http://cplint.lamping.unife.it/help/help-cplint.html">manual</a> (or <a target="_blank" href="https://github.com/friguzzi/cplint/blob/master/doc/help-cplint.pdf">PDF version</a>).</p>
                    <hr>
                    <p><a href="#index">Back to Index</a></p>

                </div>
            </div>


            <div id="footer">
                <footer>
                    <div class="separation-line unife-teal"></div>
                    <div class="w3-container w3-padding-left">
                        <div class="w3-padding-left w3-small">
                            <p>
                                <a href="https://sites.google.com/a/unife.it/ml/">
                                    Machine Learning @ unife 
                                </a> - University of Ferrara 
                            </p>
                        </div>
                    </div>
                </footer>             
            </div>
        </div>
        <script>$(function () {
                $(".nb-cell.query").PLPT({swish: "http://cplint.lamping.unife.it/"});
            });</script>
    </body>
</html>
